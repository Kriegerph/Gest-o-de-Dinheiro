import{$a as se,Ab as Me,B as s,Bb as De,C as K,Cb as Pe,D as _,E as Be,F as p,G as i,H as n,Ha as He,I as f,Ja as $e,La as Le,M as N,Ma as Ye,N as B,Na as We,O as P,P as h,R as u,S as L,Sa as je,Ta as ze,U as O,W as a,X as S,Xa as qe,Y as x,Ya as re,Z as J,Za as G,_a as le,a as A,ab as ce,b as H,bb as me,ca as I,cb as de,da as Q,db as pe,eb as w,fb as ue,g as Oe,ga as b,gb as _e,h as D,ha as R,i as F,ia as q,j as M,ja as C,jb as ge,k as W,ka as Y,kb as ve,l as $,ma as X,mb as fe,na as Z,nb as he,o as Ae,oa as ee,ob as xe,p as j,pa as te,pb as be,qb as ye,r as z,ra as ne,s as Ne,sa as ie,ta as ae,u as E,ub as Ie,v as g,w as v,wa as Re,wb as we,xb as Ce,yb as Se,za as oe,zb as Ee}from"./chunk-DCDGZ2DH.js";var k=o=>[o,"BRL","symbol","1.2-2","pt-BR"],Qe=(o,t)=>({"bg-success-subtle text-success":o,"bg-secondary-subtle text-secondary":t}),Xe=o=>["/app/investments",o];function Ze(o,t){if(o&1){let e=P();i(0,"button",10),h("click",function(){g(e);let l=u();return v(l.resetForm())}),a(1," Cancelar edi\xE7\xE3o "),n()}}function et(o,t){o&1&&(i(0,"div",11)(1,"div",49),a(2," Sem \xEDndice atualizado para investimentos indexados. "),n()())}function tt(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;p("value",e.value),s(),S(e.label)}}function nt(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;p("value",e.value),s(),S(e.label)}}function it(o,t){o&1&&(i(0,"div")(1,"label",23),a(2,"Valor aplicado inicial"),n(),f(3,"input",51),n())}function at(o,t){o&1&&(i(0,"div",52)(1,"div",28)(2,"div",29)(3,"label",23),a(4,"Data de alinhamento"),n(),f(5,"input",53),n(),i(6,"div",29)(7,"label",23),a(8,"Valor atual"),n(),f(9,"input",54),n()(),i(10,"div",28)(11,"div",29)(12,"label",23),a(13,"Total investido at\xE9 hoje"),n(),f(14,"input",55),n(),i(15,"div",29)(16,"label",23),a(17,"Rendimento acumulado at\xE9 hoje"),n(),f(18,"input",56),n()(),i(19,"small",27),a(20," Valores anteriores ao app servem para alinhar seu hist\xF3rico. O app n\xE3o recalcula o passado. "),n()())}function ot(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;p("value",e.value),s(),S(e.label)}}function rt(o,t){if(o&1&&(i(0,"div",28)(1,"div",29)(2,"label",23),a(3),n(),f(4,"input",57),n()()),o&2){let e=u(2);s(3),S(e.manualRateLabel)}}function lt(o,t){o&1&&(i(0,"div",29)(1,"label",23),a(2,"% do CDI"),n(),f(3,"input",60),n())}function st(o,t){if(o&1&&(i(0,"div",28),_(1,lt,4,0,"div",58),i(2,"div")(3,"label",23),a(4,"Taxa placeholder (a.m.)"),n(),f(5,"input",59),n()()),o&2){let e=u(2);s(),p("ngIf",e.yieldMode==="cdi_percent"),s(),O("col-6",e.yieldMode==="cdi_percent")("col-12",e.yieldMode!=="cdi_percent")}}function ct(o,t){o&1&&f(0,"span",61)}function mt(o,t){if(o&1&&(i(0,"div",64),a(1),b(2,"currency"),n()),o&2){let e=u().$implicit;s(),x(" Rendimento pre-app: ",C(2,1,I(7,k,e.preAppYield))," ")}}function dt(o,t){o&1&&(i(0,"div",74),a(1," Sem \xEDndice atualizado "),n())}function pt(o,t){o&1&&(i(0,"div",64),a(1," Taxa placeholder aplicada "),n())}function ut(o,t){o&1&&(i(0,"div",64),a(1," Total (inclui antes do app) "),n())}function _t(o,t){if(o&1&&(i(0,"a",75),f(1,"i",76),i(2,"span",73),a(3,"Detalhes"),n()()),o&2){let e=u().$implicit;p("routerLink",I(1,Xe,e.id))}}function gt(o,t){if(o&1){let e=P();i(0,"tr")(1,"td")(2,"div",63),a(3),n(),i(4,"div",64),a(5),n(),_(6,mt,3,9,"div",65),n(),i(7,"td",48)(8,"div",63),a(9),b(10,"currency"),n(),i(11,"div",64),a(12,"Base no sistema"),n()(),i(13,"td",48)(14,"div",63),a(15),b(16,"currency"),n(),i(17,"div",64),a(18,"Estimado"),n(),_(19,dt,2,0,"div",66)(20,pt,2,0,"div",65),i(21,"div",64),a(22),n()(),i(23,"td",48)(24,"div",63),a(25),b(26,"currency"),n(),i(27,"div",64),a(28),b(29,"number"),n(),_(30,ut,2,0,"div",65),n(),i(31,"td")(32,"span",67),a(33),n()(),i(34,"td",68)(35,"div",69),_(36,_t,4,3,"a",70),i(37,"button",71),h("click",function(){let l=g(e).$implicit,d=u(3);return v(d.edit(l))}),f(38,"i",72),i(39,"span",73),a(40,"Editar"),n()()()()()}if(o&2){let e=t.$implicit;s(3),S(e.name),s(2),S(e.typeLabel),s(),p("ngIf",e.hadBeforeApp),s(3),x(" ",C(10,18,I(39,k,e.principalBase))," "),s(6),x(" ",C(16,24,I(41,k,e.totalEstimated))," "),s(4),p("ngIf",e.indexMissing),s(),p("ngIf",e.placeholderUsed),s(2),x(" Atualizado ",e.updatedLabel==="hoje"?"hoje":"em "+e.updatedLabel," "),s(2),O("text-success",e.totalYield>=0)("text-danger",e.totalYield<0),s(),x(" ",C(26,30,I(43,k,e.totalYield))," "),s(3),x("",q(29,36,e.totalReturnPercent,"1.0-2"),"%"),s(2),p("ngIf",e.hadBeforeApp),s(2),p("ngClass",Q(45,Qe,e.status==="active",e.status==="inactive")),s(),x(" ",e.statusLabel," "),s(3),p("ngIf",e.id)}}function vt(o,t){if(o&1&&(N(0),_(1,gt,41,48,"tr",62),B()),o&2){let e=u().ngIf,r=u();s(),p("ngForOf",e.items)("ngForTrackBy",r.trackById)}}function ft(o,t){if(o&1){let e=P();i(0,"tr")(1,"td",77)(2,"div",78)(3,"div"),a(4,"Nenhum investimento cadastrado."),n(),i(5,"button",79),h("click",function(){g(e);let l=u(2);return v(l.resetForm())}),a(6," Novo investimento "),n()()()()}}function ht(o,t){if(o&1){let e=P();N(0),i(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),a(5,"Total investido"),n(),i(6,"div",15),a(7),b(8,"currency"),n(),i(9,"div",16),a(10,"Capital aplicado"),n()(),i(11,"div",13)(12,"div",14),a(13,"Total atual estimado"),n(),i(14,"div",15),a(15),b(16,"currency"),n(),i(17,"div",16),a(18,"Capital + rendimentos"),n()(),i(19,"div",13)(20,"div",14),a(21,"Rendimento"),n(),i(22,"div",15),a(23),b(24,"currency"),n(),i(25,"div",16),a(26),b(27,"number"),n()(),i(28,"div",13)(29,"div",14),a(30,"Atualizado em"),n(),i(31,"div",15),a(32),n(),i(33,"div",17),a(34,"Estimado"),n()()()(),_(35,et,3,0,"div",18),i(36,"div",19)(37,"div",20)(38,"h6",21),a(39),n(),i(40,"form",22),h("ngSubmit",function(){g(e);let l=u();return v(l.save())}),i(41,"div")(42,"label",23),a(43,"Nome"),n(),f(44,"input",24),n(),i(45,"div")(46,"label",23),a(47,"Tipo"),n(),i(48,"select",25),h("change",function(){g(e);let l=u();return v(l.onTypeChange())}),_(49,tt,2,2,"option",26),n(),i(50,"small",27),a(51," Ex: Caixinha Nubank = Renda fixa + % do CDI (100) + capitaliza\xE7\xE3o di\xE1ria. "),n()(),i(52,"div",28)(53,"div",29)(54,"label",23),a(55,"Data de inicio real"),n(),f(56,"input",30),n(),i(57,"div",29)(58,"label",23),a(59,"Status"),n(),i(60,"select",31),_(61,nt,2,2,"option",26),n()()(),i(62,"div",32)(63,"input",33),h("change",function(){g(e);let l=u();return v(l.onBeforeAppToggle())}),n(),i(64,"label",34),a(65," Investimento j\xE1 existia antes do app? "),n()(),_(66,it,4,0,"div",35)(67,at,21,0,"div",36),i(68,"div")(69,"label",23),a(70,"Regra de rendimento"),n(),i(71,"select",37),h("change",function(){g(e);let l=u();return v(l.onYieldModeChange())}),_(72,ot,2,2,"option",26),n()(),_(73,rt,5,1,"div",38)(74,st,6,5,"div",38),i(75,"div",28)(76,"div")(77,"label",23),a(78,"Capitaliza\xE7\xE3o"),n(),i(79,"select",39)(80,"option",40),a(81,"Mensal"),n(),i(82,"option",41),a(83,"Di\xE1ria"),n()()()(),i(84,"div",6)(85,"button",42),_(86,ct,1,0,"span",43),a(87),n(),i(88,"button",44),h("click",function(){g(e);let l=u();return v(l.resetForm())}),a(89,"Limpar"),n()()()()(),i(90,"div",45)(91,"div",20)(92,"div",46)(93,"table",47)(94,"thead")(95,"tr",27)(96,"th"),a(97,"Investimento"),n(),i(98,"th",48),a(99,"Base"),n(),i(100,"th",48),a(101,"Atual estimado"),n(),i(102,"th",48),a(103,"Rendimento"),n(),i(104,"th"),a(105,"Status"),n(),i(106,"th",48),a(107,"A\xE7\xF5es"),n()()(),i(108,"tbody"),_(109,vt,2,2,"ng-container",8),n(),_(110,ft,7,0,"ng-template",null,1,Y),n()()()(),B()}if(o&2){let e=t.ngIf,r=L(111),l=u();s(7),x(" ",C(8,24,I(45,k,e.summary.totalInvested))," "),s(8),x(" ",C(16,30,I(47,k,e.summary.totalEstimated))," "),s(8),x(" ",C(24,36,I(49,k,e.summary.totalYield))," "),s(3),x(" Rentabilidade: ",q(27,42,e.summary.totalYieldPercent,"1.0-2"),"% "),s(6),S(e.summary.updatedLabel),s(3),p("ngIf",e.summary.indexMissing),s(4),S(l.editingId?"Editar investimento":"Novo investimento"),s(),p("formGroup",l.form),s(9),p("ngForOf",l.typeOptions),s(12),p("ngForOf",l.statusOptions),s(5),p("ngIf",!l.isBeforeApp),s(),p("ngIf",l.isBeforeApp),s(5),p("ngForOf",l.yieldOptions),s(),p("ngIf",l.isManualMode),s(),p("ngIf",l.isIndexMode),s(2),O("col-6",l.isManualMode)("col-12",l.isIndexMode),s(9),p("disabled",l.saving),s(),p("ngIf",l.saving),s(),x(" ",l.saving?"Salvando...":l.editingId?"Salvar altera\xE7\xF5es":"Adicionar"," "),s(22),p("ngIf",e.items.length>0)("ngIfElse",r)}}function xt(o,t){o&1&&(i(0,"div",11)(1,"div",80),f(2,"div",81)(3,"div",82),n()())}function bt(o,t){if(o&1&&(i(0,"div",11)(1,"div",80),f(2,"div",81)(3,"div",82),n()(),_(4,xt,4,0,"div",83)),o&2){let e=u();s(4),p("ngForOf",e.skeletonRows)}}function yt(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;p("value",e.id),s(),x(" ",e.name," ")}}function It(o,t){o&1&&f(0,"span",61)}function wt(o,t){if(o&1){let e=P();i(0,"div",84),h("click",function(){g(e);let l=u();return v(l.closeDeposit())}),i(1,"div",85),h("click",function(l){return g(e),v(l.stopPropagation())}),i(2,"div",86)(3,"h6",87),a(4),n(),i(5,"button",10),h("click",function(){g(e);let l=u();return v(l.closeDeposit())}),a(6,"Fechar"),n()(),i(7,"form",88),h("ngSubmit",function(){g(e);let l=u();return v(l.confirmDeposit())}),i(8,"div")(9,"label",23),a(10,"Valor"),n(),f(11,"input",89),n(),i(12,"div",90)(13,"div",91)(14,"label",23),a(15,"Data"),n(),f(16,"input",92),n(),i(17,"div",93)(18,"label",23),a(19),n(),i(20,"select",94)(21,"option",95),a(22,"Selecione..."),n(),_(23,yt,2,2,"option",26),b(24,"async"),n()()(),i(25,"div",96)(26,"div",97)(27,"div",32)(28,"input",98),h("change",function(){g(e);let l=u();return v(l.onDepositHistoricalToggle())}),n(),i(29,"label",99),a(30," Movimenta\xE7\xE3o anterior ao cadastro do investimento (hist\xF3rico) "),n()()(),i(31,"small",100),a(32," N\xE3o gera lan\xE7amento e n\xE3o altera o saldo das contas. Serve apenas para montar o hist\xF3rico. "),n()(),i(33,"div")(34,"label",23),a(35,"Observa\xE7\xE3o"),n(),f(36,"input",101),n(),i(37,"div",6)(38,"button",42),_(39,It,1,0,"span",43),a(40),n(),i(41,"button",44),h("click",function(){g(e);let l=u();return v(l.closeDeposit())}),a(42,"Cancelar"),n()()()()()}if(o&2){let e,r,l,d=u();s(4),x("Aportar em ",d.selectedInvestment==null?null:d.selectedInvestment.name),s(3),p("formGroup",d.depositForm),s(12),x(" ",(e=d.depositForm.get("isHistorical"))!=null&&e.value?"Conta (opcional)":"Conta de origem"," "),s(4),p("ngForOf",R(24,9,d.accounts$)),s(8),O("historical-helper--hidden",!((r=d.depositForm.get("isHistorical"))!=null&&r.value)),s(7),p("disabled",d.submittingDeposit),s(),p("ngIf",d.submittingDeposit),s(),x(" ",(l=d.depositForm.get("isHistorical"))!=null&&l.value?"Registrar no hist\xF3rico":"Confirmar aporte"," ")}}function Ct(o,t){o&1&&(i(0,"div",74),a(1," Valor estimado. Sem \xEDndice atualizado. "),n())}function St(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;p("value",e.id),s(),x(" ",e.name," ")}}function Et(o,t){o&1&&(i(0,"div")(1,"div",106),f(2,"input",107),i(3,"label",108),a(4," Descontar IR automaticamente (estimativa) "),n()(),i(5,"small",27),a(6," O valor l\xEDquido considera o desconto estimado de Imposto de Renda, como ocorre nos bancos. "),n()())}function Mt(o,t){if(o&1&&(i(0,"div",109)(1,"div",110)(2,"span"),a(3,"Lucro estimado"),n(),i(4,"strong"),a(5),b(6,"currency"),n()(),i(7,"div",110)(8,"span"),a(9,"Al\xEDquota de IR (%)"),n(),i(10,"strong"),a(11),b(12,"number"),n()(),i(13,"div",110)(14,"span"),a(15,"IR estimado"),n(),i(16,"strong"),a(17),b(18,"currency"),n()(),i(19,"div",110)(20,"span"),a(21,"Valor l\xEDquido a receber"),n(),i(22,"strong"),a(23),b(24,"currency"),n()()()),o&2){let e=t.ngIf;s(5),S(C(6,4,I(25,k,e.profitPortion))),s(6),S(q(12,10,e.irRate*100,"1.0-2")),s(6),S(C(18,13,I(27,k,e.irValue))),s(6),S(C(24,19,I(29,k,e.netAmount)))}}function Dt(o,t){o&1&&(i(0,"div",64),a(1," Valores estimados. O desconto real pode variar conforme regras do banco. "),n())}function Pt(o,t){o&1&&f(0,"span",61)}function Vt(o,t){if(o&1){let e=P();i(0,"div",84),h("click",function(){g(e);let l=u();return v(l.closeWithdraw())}),i(1,"div",85),h("click",function(l){return g(e),v(l.stopPropagation())}),i(2,"div",86)(3,"h6",87),a(4),n(),i(5,"button",10),h("click",function(){g(e);let l=u();return v(l.closeWithdraw())}),a(6,"Fechar"),n()(),i(7,"div",102),a(8),b(9,"currency"),n(),_(10,Ct,2,0,"div",66),i(11,"form",88),h("ngSubmit",function(){g(e);let l=u();return v(l.confirmWithdraw())}),i(12,"div")(13,"label",23),a(14,"Valor"),n(),f(15,"input",89),n(),i(16,"div",90)(17,"div",91)(18,"label",23),a(19,"Data"),n(),f(20,"input",92),n(),i(21,"div",93)(22,"label",23),a(23),n(),i(24,"select",94)(25,"option",95),a(26,"Selecione..."),n(),_(27,St,2,2,"option",26),b(28,"async"),n()()(),i(29,"div",96)(30,"div",97)(31,"div",32)(32,"input",103),h("change",function(){g(e);let l=u();return v(l.onWithdrawHistoricalToggle())}),n(),i(33,"label",104),a(34," Movimenta\xE7\xE3o anterior ao cadastro do investimento (hist\xF3rico) "),n()()(),i(35,"small",100),a(36," N\xE3o gera lan\xE7amento e n\xE3o altera o saldo das contas. Serve apenas para montar o hist\xF3rico. "),n()(),_(37,Et,7,0,"div",35)(38,Mt,25,31,"div",105),i(39,"div")(40,"label",23),a(41,"Observacao"),n(),f(42,"input",101),n(),_(43,Dt,2,0,"div",65),i(44,"div",6)(45,"button",42),_(46,Pt,1,0,"span",43),a(47),n(),i(48,"button",44),h("click",function(){g(e);let l=u();return v(l.closeWithdraw())}),a(49,"Cancelar"),n()()()()()}if(o&2){let e,r,l,d,m,c=u();s(4),x("Resgatar de ",c.selectedInvestment==null?null:c.selectedInvestment.name),s(4),x(" Valor estimado atual: ",C(9,14,I(22,k,c.selectedInvestment==null?null:c.selectedInvestment.totalEstimated))," "),s(2),p("ngIf",c.selectedInvestment==null?null:c.selectedInvestment.indexMissing),s(),p("formGroup",c.withdrawForm),s(12),x(" ",(e=c.withdrawForm.get("isHistorical"))!=null&&e.value?"Conta (opcional)":"Conta de destino"," "),s(4),p("ngForOf",R(28,20,c.accounts$)),s(8),O("historical-helper--hidden",!((r=c.withdrawForm.get("isHistorical"))!=null&&r.value)),s(2),p("ngIf",!((l=c.withdrawForm.get("isHistorical"))!=null&&l.value)),s(),p("ngIf",c.withdrawIrEstimate),s(5),p("ngIf",!((d=c.withdrawForm.get("isHistorical"))!=null&&d.value)),s(2),p("disabled",c.submittingWithdraw),s(),p("ngIf",c.submittingWithdraw),s(),x(" ",(m=c.withdrawForm.get("isHistorical"))!=null&&m.value?"Registrar no historico":"Confirmar resgate"," ")}}var Ve=class o{fb=E(Ie);auth=E(me);accountsService=E(Ce);categoriesService=E(ce);investmentsService=E(De);indicesService=E(Me);calculator=E(Ee);notifications=E(Pe);todayYmd=re(new Date);skeletonRows=Array.from({length:4});editingId=null;saving=!1;togglingId=null;loadingInvestments=!0;showDepositModal=!1;showWithdrawModal=!1;submittingDeposit=!1;submittingWithdraw=!1;selectedInvestment=null;typeOptions=[{value:"fixed_income",label:"Renda fixa"},{value:"savings",label:"Poupan\xE7a"},{value:"cdb",label:"CDB"},{value:"treasury_selic",label:"Tesouro Selic"},{value:"manual",label:"Manual"}];yieldOptions=[{value:"manual_monthly",label:"Manual (a.m.)"},{value:"manual_yearly",label:"Manual (a.a.)"},{value:"cdi_percent",label:"% do CDI"},{value:"selic",label:"Selic"}];statusOptions=[{value:"active",label:"Ativo"},{value:"inactive",label:"Inativo"}];form=this.fb.group({name:["",[w.required,w.minLength(2)]],type:["savings",w.required],realStartDate:[this.todayYmd,w.required],status:["active",w.required],hadBeforeApp:[!1],systemStartDate:[this.todayYmd],currentValueAtOnboarding:[null],totalInvestedToDate:[null],preAppYield:[null],principalBase:[null,[w.min(0)]],yieldMode:["manual_monthly",w.required],manualRate:[null],cdiPercent:[100],compounding:["monthly"]});depositForm=this.fb.group({amount:[null,[w.required,w.min(.01)]],date:[this.todayYmd,w.required],accountId:["",w.required],notes:[""],isHistorical:[!1]});withdrawForm=this.fb.group({amount:[null,[w.required,w.min(.01)]],date:[this.todayYmd,w.required],accountId:["",w.required],notes:[""],isHistorical:[!1],applyIr:[!0]});latestCdi$=this.indicesService.latest$("cdi");latestSelic$=this.indicesService.latest$("selic");investments$=this.auth.user$.pipe(z(()=>this.loadingInvestments=!0),j(t=>t?this.investmentsService.list$(t.uid):D([])),M(t=>t??[]),$(()=>D([])));accounts$=this.auth.user$.pipe(j(t=>t?this.accountsService.list$(t.uid):D([])),M(t=>t.filter(e=>(e.type??"bank")!=="investment")),$(()=>D([])));view$=W([this.investments$,this.latestCdi$,this.latestSelic$]).pipe(M(([t,e,r])=>this.buildView(t,{cdi:e,selic:r})),z(()=>this.loadingInvestments=!1),$(()=>(this.loadingInvestments=!1,D(this.emptyView()))));get isBeforeApp(){return!!this.form.get("hadBeforeApp")?.value}get yieldMode(){return this.form.get("yieldMode")?.value}get isManualMode(){return this.yieldMode==="manual_monthly"||this.yieldMode==="manual_yearly"}get isIndexMode(){return this.yieldMode==="cdi_percent"||this.yieldMode==="selic"}get manualRateLabel(){return this.yieldMode==="manual_yearly"?"Taxa a.a. (%)":"Taxa a.m. (%)"}trackById(t,e){return e.id}onBeforeAppToggle(){this.isBeforeApp?this.form.get("systemStartDate")?.value||this.form.patchValue({systemStartDate:this.todayYmd}):this.form.patchValue({systemStartDate:this.form.get("realStartDate")?.value||this.todayYmd,currentValueAtOnboarding:null,totalInvestedToDate:null,preAppYield:null})}onYieldModeChange(){this.form.patchValue({compounding:this.isIndexMode?"daily":"monthly"})}onTypeChange(){let t=this.form.get("type")?.value;this.editingId||t!=="fixed_income"||this.hasYieldOverrides()||this.form.patchValue({yieldMode:"cdi_percent",cdiPercent:100,compounding:"daily"})}edit(t){let e=t.currentValueAtOnboarding??Number(t.principalBase??0)+Number(t.preAppYield??0);this.editingId=t.id||null,this.form.patchValue({name:t.name,type:t.type,realStartDate:t.realStartDate,status:t.status,hadBeforeApp:t.hadBeforeApp,systemStartDate:t.systemStartDate,currentValueAtOnboarding:e,totalInvestedToDate:t.totalInvestedToDate??null,preAppYield:t.preAppYield??null,principalBase:t.principalBase??null,yieldMode:t.yieldMode,manualRate:t.manualRate??null,cdiPercent:t.cdiPercent??100,compounding:t.compounding??(t.yieldMode==="cdi_percent"||t.yieldMode==="selic"?"daily":"monthly")})}resetForm(){this.editingId=null,this.form.reset({name:"",type:"savings",realStartDate:this.todayYmd,status:"active",hadBeforeApp:!1,systemStartDate:this.todayYmd,currentValueAtOnboarding:null,totalInvestedToDate:null,preAppYield:null,principalBase:null,yieldMode:"manual_monthly",manualRate:null,cdiPercent:100,compounding:"monthly"})}async save(){let t=this.validateForm();if(t){this.notifications.warning(t);return}let e=await F(this.auth.user$);if(!e)return;let r=this.buildPayload();this.saving=!0;try{this.editingId?await this.investmentsService.update(e.uid,this.editingId,r):await this.investmentsService.add(e.uid,r),this.notifications.success("Salvo com sucesso."),this.resetForm()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.saving=!1}}async toggleStatus(t){if(!t.id)return;let e=await F(this.auth.user$);if(!e)return;let r=t.status==="active"?"inactive":"active";this.togglingId=t.id;try{await this.investmentsService.update(e.uid,t.id,{status:r}),this.notifications.success(r==="active"?"Investimento reativado.":"Investimento inativado.")}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.togglingId===t.id&&(this.togglingId=null)}}openDeposit(t){this.selectedInvestment=t,this.showWithdrawModal=!1,this.showDepositModal=!0,this.depositForm.reset({amount:null,date:this.todayYmd,accountId:"",notes:"",isHistorical:!1}),this.updateHistoricalState(this.depositForm,t)}closeDeposit(){this.showDepositModal=!1,this.selectedInvestment=null}openWithdraw(t){this.selectedInvestment=t,this.showDepositModal=!1,this.showWithdrawModal=!0,this.withdrawForm.reset({amount:null,date:this.todayYmd,accountId:"",notes:"",isHistorical:!1,applyIr:!0}),this.updateHistoricalState(this.withdrawForm,t)}closeWithdraw(){this.showWithdrawModal=!1,this.selectedInvestment=null}onDepositHistoricalToggle(){this.updateHistoricalState(this.depositForm,this.selectedInvestment)}onWithdrawHistoricalToggle(){this.updateHistoricalState(this.withdrawForm,this.selectedInvestment)}get withdrawIrEstimate(){let t=this.selectedInvestment;if(!t||this.withdrawForm.get("isHistorical")?.value||!this.withdrawForm.get("applyIr")?.value)return null;let e=Number(this.withdrawForm.get("amount")?.value??0);if(!Number.isFinite(e)||e<=0)return null;let r=Number(t.totalEstimated??0);if(!Number.isFinite(r)||r<=0)return null;let l=t.realStartDate||t.systemStartDate||"";return this.calculator.calculateRescueIR({principalBase:Number(t.principalBase??0),currentValue:r,rescueAmount:e,investmentStartDate:l})}async confirmDeposit(){if(this.depositForm.invalid){this.depositForm.markAllAsTouched(),this.notifications.warning("Preencha os campos obrigat\xF3rios.");return}let t=await F(this.auth.user$),e=this.selectedInvestment;if(!t||!e?.id)return;let r=!!this.depositForm.get("isHistorical")?.value,l=Number(this.depositForm.get("amount")?.value??0);if(!Number.isFinite(l)||l<=0){this.notifications.warning("Informe um valor v\xE1lido.");return}let d=this.depositForm.get("date")?.value||this.todayYmd;if(r){let m=this.validateHistoricalDate(d,e);if(m){this.notifications.warning(m);return}}this.submittingDeposit=!0;try{let m=r?null:await this.categoriesService.ensureCategory(t.uid,{name:"Investimentos",type:"expense",color:"#f97316"});await this.investmentsService.createDeposit(t.uid,{investmentId:e.id,accountId:this.depositForm.get("accountId")?.value||null,amount:l,date:d,categoryId:m,notes:this.depositForm.get("notes")?.value||null,isHistorical:r}),this.notifications.success("Aporte registrado com sucesso."),this.closeDeposit()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.submittingDeposit=!1}}async confirmWithdraw(){if(this.withdrawForm.invalid){this.withdrawForm.markAllAsTouched(),this.notifications.warning("Preencha os campos obrigat\xF3rios.");return}let t=await F(this.auth.user$),e=this.selectedInvestment;if(!t||!e?.id)return;let r=!!this.withdrawForm.get("isHistorical")?.value,l=!!this.withdrawForm.get("applyIr")?.value,d=Number(this.withdrawForm.get("amount")?.value??0);if(!Number.isFinite(d)||d<=0){this.notifications.warning("Informe um valor v\xE1lido.");return}let m=this.withdrawForm.get("date")?.value||this.todayYmd;if(r){let c=this.validateHistoricalDate(m,e);if(c){this.notifications.warning(c);return}}else{let c=Number(e.totalEstimated??0);if(this.canValidateEstimated(e)&&c>0){let y=c*1.02;if(d>y){this.notifications.warning("Valor acima do estimado do investimento.");return}}else this.notifications.warning("Valor estimado. Verifique antes de confirmar.")}this.submittingWithdraw=!0;try{let c=r?null:await this.resolveWithdrawCategory(t.uid);await this.investmentsService.createWithdraw(t.uid,{investmentId:e.id,accountId:this.withdrawForm.get("accountId")?.value||null,amount:d,date:m,categoryId:c,notes:this.withdrawForm.get("notes")?.value||null,isHistorical:r,applyIr:!r&&l,currentValue:Number(e.totalEstimated??0)}),this.notifications.success("Resgate registrado com sucesso."),this.closeWithdraw()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.submittingWithdraw=!1}}updateHistoricalState(t,e){let r=!!t.get("isHistorical")?.value,l=t.get("accountId");l&&(r?l.clearValidators():l.setValidators([w.required]),l.updateValueAndValidity({emitEvent:!1}));let d=t.get("applyIr");if(d&&(r?(d.setValue(!1,{emitEvent:!1}),d.disable({emitEvent:!1})):d.enable({emitEvent:!1})),r&&e?.systemStartDate){let m=t.get("date"),c=e.systemStartDate,y=m?.value;m&&c&&(!y||y>c)&&m.setValue(c)}}validateHistoricalDate(t,e){if(!t)return"Informe a data do movimento.";if(t>this.todayYmd)return"Movimento historico deve ser no passado.";let r=e?.systemStartDate||e?.realStartDate;return r&&t>r?"Movimento hist\xF3rico deve ser anterior a data de cadastro.":null}validateForm(){if(this.form.markAllAsTouched(),this.form.invalid)return"Preencha os campos obrigat\xF3rios.";let t=this.form.value;return!t.hadBeforeApp&&Number(t.principalBase??0)<=0?"Informe o valor aplicado inicial.":t.hadBeforeApp&&Number(t.currentValueAtOnboarding??0)<=0?"Informe o valor atual do investimento.":t.hadBeforeApp&&!t.systemStartDate?"Informe a data de alinhamento.":this.isManualMode&&Number(t.manualRate??0)<=0?"Informe a taxa manual.":this.yieldMode==="cdi_percent"&&Number(t.cdiPercent??0)<=0?"Informe o percentual do CDI.":null}buildPayload(){let t=this.form.value,e=!!t.hadBeforeApp,r=t.realStartDate||this.todayYmd,l=t.systemStartDate||r,d=Number(t.principalBase??0),m=0,c=this.toNumberOrNull(t.totalInvestedToDate),y=this.toNumberOrNull(t.currentValueAtOnboarding),T=this.toNumberOrNull(t.preAppYield);if(e){let U=Number(y??0);c!==null&&c>0?(d=c,m=Math.max(0,U-c)):T!==null&&T>=0?(m=T,d=Math.max(0,U-m)):(d=U,m=0)}else l=r,c=null,y=null,m=0;return{name:(t.name??"").trim(),type:t.type,status:t.status,realStartDate:r,systemStartDate:l,hadBeforeApp:e,principalBase:d,preAppYield:m,totalInvestedToDate:c,currentValueAtOnboarding:y,yieldMode:t.yieldMode,manualRate:this.toNumberOrNull(t.manualRate),cdiPercent:this.toNumberOrNull(t.cdiPercent),compounding:t.compounding??"monthly"}}buildView(t,e){let r=this.calculator.summarize(t,e),l=this.pickLatestYmd(t.map(m=>m.lastYieldCalculationAt))??r.updatedAt,d=t.map(m=>{let c=this.calculator.calculate(m,e),y=m.lastYieldCalculationAt||c.updatedAt,T=this.buildUpdatedLabel(y);return H(A(A({},m),c),{typeLabel:this.typeLabel(m.type),statusLabel:m.status==="active"?"Ativo":"Inativo",updatedLabel:T})}).sort((m,c)=>m.status!==c.status?m.status==="active"?-1:1:m.name.localeCompare(c.name));return{summary:H(A({},r),{updatedAt:l,updatedLabel:this.buildUpdatedLabel(l)}),items:d}}typeLabel(t){return this.typeOptions.find(r=>r.value===t)?.label??"Manual"}canValidateEstimated(t){return!t.indexMissing&&!t.placeholderUsed}async resolveWithdrawCategory(t){let e=await F(this.categoriesService.list$(t)),r=c=>c.trim().toLowerCase(),l=e.filter(c=>c.type==="income"),d=l.find(c=>r(c.name)==="resgates");if(d?.id)return d.id;let m=l.find(c=>r(c.name)==="investimentos");return m?.id?m.id:this.categoriesService.ensureCategory(t,{name:"Resgates",type:"income",color:"#22c55e"})}hasYieldOverrides(){return!!(this.form.get("yieldMode")?.dirty||this.form.get("manualRate")?.dirty||this.form.get("cdiPercent")?.dirty||this.form.get("compounding")?.dirty)}toNumberOrNull(t){if(t==null||t==="")return null;let e=Number(t);return Number.isFinite(e)?e:null}emptyView(){return{summary:{totalInvested:0,totalEstimated:0,totalYield:0,totalYieldPercent:0,updatedAt:null,updatedLabel:"-",indexMissing:!1,count:0},items:[]}}buildUpdatedLabel(t){if(!t)return"-";let e=se(new Date);return t===e?"hoje":G(t)}pickLatestYmd(t){let e=t.filter(r=>!!r);return e.length?e.sort().slice(-1)[0]:null}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=K({type:o,selectors:[["app-investments-page"]],decls:15,vars:7,consts:[["loadingTpl",""],["emptyInvestmentsTpl",""],[1,"row","g-3","investments-page"],[1,"col-12","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"text-uppercase","text-primary","small","mb-1"],[1,"fw-bold","mb-0"],[1,"d-flex","gap-2"],["class","btn btn-sm btn-outline-light","type","button",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","modal-backdrop",3,"click",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],[1,"col-12"],[1,"summary-grid"],[1,"glass-card","summary-card"],[1,"summary-label"],[1,"summary-value"],[1,"summary-sub"],[1,"summary-tag"],["class","col-12",4,"ngIf"],[1,"col-lg-4"],[1,"glass-card","p-3","h-100"],[1,"fw-semibold","mb-3"],[1,"d-grid","gap-3",3,"ngSubmit","formGroup"],[1,"form-label","text-secondary"],["formControlName","name","placeholder","Ex: Reserva",1,"form-control","glass-input"],["formControlName","type",1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"text-secondary"],[1,"row","g-2"],[1,"col-6"],["type","date","formControlName","realStartDate",1,"form-control","glass-input"],["formControlName","status",1,"form-select"],[1,"form-check","form-switch"],["type","checkbox","id","investment-before-app","formControlName","hadBeforeApp",1,"form-check-input",3,"change"],["for","investment-before-app",1,"form-check-label"],[4,"ngIf"],["class","d-grid gap-2",4,"ngIf"],["formControlName","yieldMode",1,"form-select",3,"change"],["class","row g-2",4,"ngIf"],["formControlName","compounding",1,"form-select"],["value","monthly"],["value","daily"],["type","submit",1,"btn","btn-primary","flex-grow-1",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["type","button",1,"btn","btn-outline-light",3,"click"],[1,"col-lg-8"],[1,"table-responsive"],[1,"table","table-hover","align-middle","table-sm","app-table","investments-table"],[1,"text-end"],[1,"glass-card","p-3","text-warning"],[3,"value"],["type","number","formControlName","principalBase","step","0.01","placeholder","Ex: 5.000,00",1,"form-control","glass-input"],[1,"d-grid","gap-2"],["type","date","formControlName","systemStartDate",1,"form-control","glass-input"],["type","number","formControlName","currentValueAtOnboarding","step","0.01","placeholder","Ex: 12.000,00",1,"form-control","glass-input"],["type","number","formControlName","totalInvestedToDate","step","0.01","placeholder","Opcional",1,"form-control","glass-input"],["type","number","formControlName","preAppYield","step","0.01","placeholder","Opcional",1,"form-control","glass-input"],["type","number","formControlName","manualRate","step","0.01","placeholder","Ex: 1.2",1,"form-control","glass-input"],["class","col-6",4,"ngIf"],["type","number","formControlName","manualRate","step","0.01","placeholder","Opcional",1,"form-control","glass-input"],["type","number","formControlName","cdiPercent","step","0.01","placeholder","Ex: 100",1,"form-control","glass-input"],[1,"spinner-border","spinner-border-sm","me-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"fw-semibold"],[1,"text-secondary","small"],["class","text-secondary small",4,"ngIf"],["class","text-warning small",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"text-end","actions-cell"],[1,"actions-stack"],["class","btn btn-sm btn-outline-light action-btn action-btn--ghost","title","Ver detalhes do investimento",3,"routerLink",4,"ngIf"],["type","button","title","Editar investimento",1,"btn","btn-sm","btn-outline-light","action-btn","action-btn--ghost",3,"click"],[1,"bi","bi-pencil"],[1,"action-label"],[1,"text-warning","small"],["title","Ver detalhes do investimento",1,"btn","btn-sm","btn-outline-light","action-btn","action-btn--ghost",3,"routerLink"],[1,"bi","bi-box-arrow-up-right"],["colspan","6"],[1,"empty-state"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"glass-card","p-3"],[1,"skeleton","skeleton-line","w-50","mb-2"],[1,"skeleton","skeleton-line","w-75"],["class","col-12",4,"ngFor","ngForOf"],[1,"modal-backdrop",3,"click"],[1,"glass-card","modal-card",3,"click"],[1,"modal-header-row"],[1,"fw-semibold","mb-0"],[1,"d-grid","gap-3","mt-3",3,"ngSubmit","formGroup"],["type","number","formControlName","amount","step","0.01","placeholder","Ex: 1.000,00",1,"form-control","glass-input"],[1,"form-grid-fixed"],[1,"form-field"],["type","date","formControlName","date",1,"form-control","glass-input"],[1,"form-field","account-field"],["formControlName","accountId",1,"form-select"],["value","","disabled",""],[1,"historical-block"],[1,"historical-toggle"],["type","checkbox","formControlName","isHistorical","id","deposit-historical-toggle",1,"form-check-input","toggle-switch",3,"change"],["for","deposit-historical-toggle",1,"form-check-label","toggle-label"],[1,"text-secondary","historical-helper"],["formControlName","notes","placeholder","Opcional",1,"form-control","glass-input"],[1,"text-secondary","small","mt-2"],["type","checkbox","formControlName","isHistorical","id","withdraw-historical-toggle",1,"form-check-input","toggle-switch",3,"change"],["for","withdraw-historical-toggle",1,"form-check-label","toggle-label"],["class","ir-preview",4,"ngIf"],[1,"form-check"],["type","checkbox","formControlName","applyIr","id","withdraw-ir-toggle",1,"form-check-input"],["for","withdraw-ir-toggle",1,"form-check-label"],[1,"ir-preview"],[1,"ir-row"]],template:function(e,r){if(e&1&&(i(0,"div",2)(1,"div",3)(2,"div")(3,"p",4),a(4,"Patrim\xF4nio"),n(),i(5,"h3",5),a(6,"Investimentos"),n()(),i(7,"div",6),_(8,Ze,2,0,"button",7),n()(),_(9,ht,112,51,"ng-container",8),b(10,"async"),_(11,bt,5,1,"ng-template",null,0,Y)(13,wt,43,11,"div",9)(14,Vt,50,24,"div",9),n()),e&2){let l=L(12);s(8),p("ngIf",r.editingId),s(),p("ngIf",R(10,5,r.view$))("ngIfElse",l),s(4),p("ngIf",r.showDepositModal),s(),p("ngIf",r.showWithdrawModal)}},dependencies:[ae,X,Z,ee,we,ge,be,ye,pe,ve,de,xe,ue,_e,he,fe,oe,te,ne,ie],styles:[".summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.summary-card[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:6px;min-height:120px}.summary-label[_ngcontent-%COMP%]{font-size:.7rem;letter-spacing:.14em;text-transform:uppercase;color:var(--app-muted)}.summary-value[_ngcontent-%COMP%]{font-size:1.45rem;font-weight:600}.summary-sub[_ngcontent-%COMP%]{font-size:.85rem;color:var(--app-muted)}.summary-tag[_ngcontent-%COMP%]{margin-top:auto;padding:4px 10px;border-radius:999px;font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;background:#6366f133;border:1px solid rgba(99,102,241,.35);color:#c7d2fe;width:fit-content}.investments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:top}.investments-table[_ngcontent-%COMP%]   td.actions-cell[_ngcontent-%COMP%]{vertical-align:middle}.actions-stack[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap}.actions-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:nowrap}.actions-secondary[_ngcontent-%COMP%]{gap:6px}.action-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:12px}.action-btn--ghost[_ngcontent-%COMP%]{opacity:.9}.action-btn--danger[_ngcontent-%COMP%]{border-color:#f8717180;color:#fca5a5}.action-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600}.action-label--secondary[_ngcontent-%COMP%]{font-weight:500}@media(max-width:992px){.action-label--secondary[_ngcontent-%COMP%]{display:none}.action-btn[_ngcontent-%COMP%]{padding:6px 8px}}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#070a14a6;display:flex;align-items:center;justify-content:center;padding:16px;z-index:1050}.modal-card[_ngcontent-%COMP%]{width:min(520px,100%);padding:20px;border-radius:18px}.modal-header-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.form-grid-fixed[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.form-grid-fixed[_ngcontent-%COMP%]   .account-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{min-height:40px;display:flex;align-items:flex-end}.form-grid-fixed[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{min-height:38px;display:flex;align-items:flex-end}.historical-block[_ngcontent-%COMP%]{margin-top:10px}.historical-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.historical-toggle[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin:0}.historical-toggle[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin:0}.historical-toggle[_ngcontent-%COMP%]   .toggle-label[_ngcontent-%COMP%]{flex:1;margin:0;line-height:1.3}.historical-toggle[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]{flex-shrink:0}.historical-helper[_ngcontent-%COMP%]{display:block;min-height:18px;margin-left:34px;opacity:.75;transition:opacity .2s ease}.historical-helper--hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}@media(max-width:768px){.form-grid-fixed[_ngcontent-%COMP%]{grid-template-columns:1fr}.historical-helper[_ngcontent-%COMP%]{margin-left:0}}.ir-preview[_ngcontent-%COMP%]{padding:12px;border-radius:14px;background:#0f172a59;border:1px solid rgba(148,163,184,.12);display:grid;gap:6px}.ir-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;font-size:.85rem;color:var(--app-muted)}.ir-row[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e2e8f0}"]})};var Te=class o{firestore=E(He);listByInvestment$(t,e){let r=Le(this.firestore,`users/${t}/investments/${e}/movements`),l=ze(r,je("date","desc"));return $e(l,{idField:"id"}).pipe(M(d=>d.map(m=>H(A({},m),{amount:Number(m.amount??0),date:qe(m.date),accountId:m.accountId??null,accountNameSnapshot:m.accountNameSnapshot??null,note:m.note??null,grossAmount:Number(m.grossAmount??m.amount??0),netAmount:m.netAmount===null||m.netAmount===void 0?null:Number(m.netAmount),irEstimated:m.irEstimated===null||m.irEstimated===void 0?null:Number(m.irEstimated),irRate:m.irRate===null||m.irRate===void 0?null:Number(m.irRate)})).map(m=>{let c=!!m.isHistorical;return H(A({},m),{isHistorical:c,affectsAccounts:m.affectsAccounts!==void 0?!!m.affectsAccounts:!c,relatedTransactionId:m.relatedTransactionId??null,source:m.source??(c?"investment_only":"ledger")})}).sort((m,c)=>{let y=this.toTimestamp(m.date)||this.toTimestamp(m.createdAt),T=this.toTimestamp(c.date)||this.toTimestamp(c.createdAt);if(y!==T)return T-y;let ke=this.toTimestamp(m.createdAt);return this.toTimestamp(c.createdAt)-ke})),z(d=>{if(!Se.production){let m=d[0]??null;console.log("[Investments] movements loaded",{count:d.length,first:m})}}))}async deleteMovement(t,e,r){let l=We(this.firestore,`users/${t}/investments/${e}/movements/${r}`);await Ye(l)}toTimestamp(t){if(!t)return 0;if(typeof t=="object"&&typeof t.toDate=="function"){let r=t.toDate();return r instanceof Date?r.getTime():0}if(t instanceof Date)return t.getTime();if(typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)){let r=le(t);return r?r.getTime():0}let e=new Date(t);return Number.isNaN(e.getTime())?0:e.getTime()}static \u0275fac=function(e){return new(e||o)};static \u0275prov=Ne({token:o,factory:o.\u0275fac,providedIn:"root"})};var V=o=>[o,"BRL","symbol","1.2-2","pt-BR"],Tt=(o,t)=>({"bg-success-subtle text-success":o,"bg-secondary-subtle text-secondary":t});function Ft(o,t){o&1&&(i(0,"div",52),a(1," Sem \xEDndice atualizado para investimentos indexados. "),n())}function Ot(o,t){o&1&&(i(0,"div",53),a(1," Taxa placeholder aplicada. "),n())}function kt(o,t){o&1&&f(0,"span",54)}function At(o,t){if(o&1&&(i(0,"div",57)(1,"div",58)(2,"div",59),a(3,"Total aportado (no app)"),n(),i(4,"div",60),a(5),b(6,"currency"),n()(),i(7,"div",58)(8,"div",59),a(9,"Total resgatado (no app)"),n(),i(10,"div",60),a(11),b(12,"currency"),n()()()),o&2){let e=u().ngIf;s(5),x(" ",C(6,2,I(14,V,e.totalDeposits))," "),s(6),x(" ",C(12,8,I(16,V,e.totalWithdraws))," ")}}function Nt(o,t){o&1&&f(0,"i",80)}function Bt(o,t){o&1&&f(0,"i",81)}function Rt(o,t){o&1&&(i(0,"span",82),a(1,"Hist\xF3rico"),n())}function Ht(o,t){o&1&&(i(0,"span",82),a(1," IR estimado "),n())}function $t(o,t){if(o&1&&(N(0),i(1,"span"),a(2),n(),B()),o&2){let e=u().$implicit,r=u(6);s(2),J("",r.movementDirectionLabel(e)," ",r.movementAccountLabel(e))}}function Lt(o,t){if(o&1&&(i(0,"span"),a(1),n()),o&2){let e=u().$implicit,r=u(6);s(),S(r.movementHistoricalAccountLabel(e))}}function Yt(o,t){if(o&1&&(i(0,"div",83)(1,"span"),a(2),b(3,"currency"),n(),i(4,"span",71),a(5,"?"),n(),i(6,"span"),a(7),b(8,"currency"),n()()),o&2){let e=u().$implicit;s(2),x(" IR estimado: ",C(3,2,I(14,V,e.irEstimated??0))," "),s(5),x(" Valor l\xEDquido recebido: ",C(8,8,I(16,V,e.netAmount??e.grossAmount??e.amount))," ")}}function Wt(o,t){o&1&&(i(0,"div",84),a(1," Sem impacto em contas "),n())}function jt(o,t){if(o&1&&(i(0,"div",85),a(1),n()),o&2){let e=u().$implicit;s(),S(e.note)}}function zt(o,t){if(o&1&&(i(0,"div",86),a(1),n()),o&2){let e=u().$implicit;s(),x(" Lan\xE7amento: ",e.relatedTransactionId," ")}}function qt(o,t){if(o&1){let e=P();i(0,"div",63)(1,"div",64),_(2,Nt,1,0,"i",65)(3,Bt,1,0,"i",66),n(),i(4,"div",67)(5,"div",68),a(6),_(7,Rt,2,0,"span",69)(8,Ht,2,0,"span",69),n(),i(9,"div",70)(10,"span"),a(11),n(),i(12,"span",71),a(13,"?"),n(),_(14,$t,3,2,"ng-container",6)(15,Lt,2,1,"ng-template",null,3,Y),n(),_(17,Yt,9,18,"div",72)(18,Wt,2,0,"div",73)(19,jt,2,1,"div",74)(20,zt,2,1,"div",75),n(),i(21,"div",76),a(22),b(23,"currency"),n(),i(24,"div",77)(25,"button",78),h("click",function(){let l=g(e).$implicit,d=u(6);return v(d.openDeleteMovement(l))}),f(26,"i",79),n()()()}if(o&2){let e=t.$implicit,r=L(16),l=u(6);s(),O("deposit",e.type==="deposit")("withdraw",e.type==="withdraw"),s(),p("ngIf",e.type==="deposit"),s(),p("ngIf",e.type==="withdraw"),s(3),x(" ",l.movementLabel(e)," "),s(),p("ngIf",e.isHistorical),s(),p("ngIf",e.type==="withdraw"&&e.irRate!==null),s(3),S(l.formatDate(e.date)),s(3),p("ngIf",!e.isHistorical)("ngIfElse",r),s(3),p("ngIf",e.type==="withdraw"&&e.irRate!==null),s(),p("ngIf",e.isHistorical),s(),p("ngIf",e.note),s(),p("ngIf",e.relatedTransactionId),s(),O("positive",e.type==="deposit")("negative",e.type==="withdraw"),s(),J(" ",e.type==="deposit"?"+":"-"," ",C(23,24,I(30,V,e.grossAmount??e.amount))," "),s(2),Be("title",e.isHistorical?null:"N\xE3o \xE9 poss\xEDvel remover aqui porque gerou lan\xE7amento."),s(),p("disabled",!e.isHistorical)}}function Gt(o,t){if(o&1&&(i(0,"div",61),_(1,qt,27,32,"div",62),n()),o&2){let e=u().ngIf,r=u(4);s(),p("ngForOf",e.items)("ngForTrackBy",r.trackByMovementId)}}function Ut(o,t){if(o&1&&(N(0),_(1,At,13,18,"div",55)(2,Gt,2,2,"div",56),B()),o&2){let e=t.ngIf;u(4);let r=L(8);s(),p("ngIf",e.hasMovements),s(),p("ngIf",e.items.length>0)("ngIfElse",r)}}function Kt(o,t){if(o&1&&(i(0,"option",111),a(1),n()),o&2){let e=t.$implicit;p("value",e.id),s(),x(" ",e.name," ")}}function Jt(o,t){o&1&&f(0,"span",112)}function Qt(o,t){if(o&1){let e=P();i(0,"div",87),h("click",function(){g(e);let l=u(4);return v(l.closeDeposit())}),i(1,"div",88),h("click",function(l){return g(e),v(l.stopPropagation())}),i(2,"div",89)(3,"h6",26),a(4),n(),i(5,"button",90),h("click",function(){g(e);let l=u(4);return v(l.closeDeposit())}),a(6," Fechar "),n()(),i(7,"form",91),h("ngSubmit",function(){g(e);let l=u(4);return v(l.confirmDeposit())}),i(8,"div")(9,"label",92),a(10,"Valor"),n(),f(11,"input",93),n(),i(12,"div",94)(13,"div",95)(14,"label",92),a(15,"Data"),n(),f(16,"input",96),n(),i(17,"div",97)(18,"label",92),a(19),n(),i(20,"select",98)(21,"option",99),a(22,"Selecione..."),n(),_(23,Kt,2,2,"option",100),b(24,"async"),n()()(),i(25,"div",101)(26,"div",102)(27,"div",103)(28,"input",104),h("change",function(){g(e);let l=u(4);return v(l.onDepositHistoricalToggle())}),n(),i(29,"label",105),a(30," Movimenta\xE7\xE3o anterior ao cadastro do investimento (hist\xF3rico) "),n()()(),i(31,"small",106),a(32," N\xE3o gera lan\xE7amento e n\xE3o altera o saldo das contas. Serve apenas para montar o hist\xF3rico. "),n()(),i(33,"div")(34,"label",92),a(35,"Observa\xE7\xE3o"),n(),f(36,"input",107),n(),i(37,"div",11)(38,"button",108),_(39,Jt,1,0,"span",109),a(40),n(),i(41,"button",110),h("click",function(){g(e);let l=u(4);return v(l.closeDeposit())}),a(42,"Cancelar"),n()()()()()}if(o&2){let e,r,l,d=u(4);s(4),x("Aportar em ",d.selectedInvestment==null?null:d.selectedInvestment.name),s(3),p("formGroup",d.depositForm),s(12),x(" ",(e=d.depositForm.get("isHistorical"))!=null&&e.value?"Conta (opcional)":"Conta de origem"," "),s(4),p("ngForOf",R(24,9,d.accounts$)),s(8),O("historical-helper--hidden",!((r=d.depositForm.get("isHistorical"))!=null&&r.value)),s(7),p("disabled",d.submittingDeposit),s(),p("ngIf",d.submittingDeposit),s(),x(" ",(l=d.depositForm.get("isHistorical"))!=null&&l.value?"Registrar no hist\xF3rico":"Confirmar aporte"," ")}}function Xt(o,t){o&1&&(i(0,"div",118),a(1," Valor estimado. Sem \xEDndice atualizado. "),n())}function Zt(o,t){if(o&1&&(i(0,"option",111),a(1),n()),o&2){let e=t.$implicit;p("value",e.id),s(),x(" ",e.name," ")}}function en(o,t){o&1&&(i(0,"div")(1,"div",119),f(2,"input",120),i(3,"label",121),a(4," Descontar IR automaticamente (estimativa) "),n()(),i(5,"small",122),a(6," O valor l\xEDquido considera o desconto estimado de Imposto de Renda, como ocorre nos bancos. "),n()())}function tn(o,t){if(o&1&&(i(0,"div",123)(1,"div",124)(2,"span"),a(3,"Lucro estimado"),n(),i(4,"strong"),a(5),b(6,"currency"),n()(),i(7,"div",124)(8,"span"),a(9,"Aliquota de IR (%)"),n(),i(10,"strong"),a(11),b(12,"number"),n()(),i(13,"div",124)(14,"span"),a(15,"IR estimado"),n(),i(16,"strong"),a(17),b(18,"currency"),n()(),i(19,"div",124)(20,"span"),a(21,"Valor l\xEDquido a receber"),n(),i(22,"strong"),a(23),b(24,"currency"),n()()()),o&2){let e=t.ngIf;s(5),S(C(6,4,I(25,V,e.profitPortion))),s(6),S(q(12,10,e.irRate*100,"1.0-2")),s(6),S(C(18,13,I(27,V,e.irValue))),s(6),S(C(24,19,I(29,V,e.netAmount)))}}function nn(o,t){o&1&&(i(0,"div",10),a(1," Valores estimados. O desconto real pode variar conforme regras do banco. "),n())}function an(o,t){o&1&&f(0,"span",112)}function on(o,t){if(o&1){let e=P();i(0,"div",87),h("click",function(){g(e);let l=u(4);return v(l.closeWithdraw())}),i(1,"div",88),h("click",function(l){return g(e),v(l.stopPropagation())}),i(2,"div",89)(3,"h6",26),a(4),n(),i(5,"button",90),h("click",function(){g(e);let l=u(4);return v(l.closeWithdraw())}),a(6," Fechar "),n()(),i(7,"div",37),a(8),b(9,"currency"),n(),_(10,Xt,2,0,"div",113),i(11,"form",91),h("ngSubmit",function(){g(e);let l=u(4);return v(l.confirmWithdraw())}),i(12,"div")(13,"label",92),a(14,"Valor"),n(),f(15,"input",93),n(),i(16,"div",94)(17,"div",95)(18,"label",92),a(19,"Data"),n(),f(20,"input",96),n(),i(21,"div",97)(22,"label",92),a(23),n(),i(24,"select",98)(25,"option",99),a(26,"Selecione..."),n(),_(27,Zt,2,2,"option",100),b(28,"async"),n()()(),i(29,"div",101)(30,"div",102)(31,"div",103)(32,"input",114),h("change",function(){g(e);let l=u(4);return v(l.onWithdrawHistoricalToggle())}),n(),i(33,"label",115),a(34," Movimenta\xE7\xE3o anterior ao cadastro do investimento (hist\xF3rico) "),n()()(),i(35,"small",106),a(36," N\xE3o gera lan\xE7amento e n\xE3o altera o saldo das contas. Serve apenas para montar o hist\xF3rico. "),n()(),_(37,en,7,0,"div",5)(38,tn,25,31,"div",116),i(39,"div")(40,"label",92),a(41,"Observa\xE7\xE3o"),n(),f(42,"input",107),n(),_(43,nn,2,0,"div",117),i(44,"div",11)(45,"button",108),_(46,an,1,0,"span",109),a(47),n(),i(48,"button",110),h("click",function(){g(e);let l=u(4);return v(l.closeWithdraw())}),a(49,"Cancelar"),n()()()()()}if(o&2){let e,r,l,d,m,c=u(4);s(4),x("Resgatar de ",c.selectedInvestment==null?null:c.selectedInvestment.name),s(4),x(" Valor estimado atual: ",C(9,14,I(22,V,c.selectedInvestment==null?null:c.selectedInvestment.totalEstimated))," "),s(2),p("ngIf",c.selectedInvestment==null?null:c.selectedInvestment.indexMissing),s(),p("formGroup",c.withdrawForm),s(12),x(" ",(e=c.withdrawForm.get("isHistorical"))!=null&&e.value?"Conta (opcional)":"Conta de destino"," "),s(4),p("ngForOf",R(28,20,c.accounts$)),s(8),O("historical-helper--hidden",!((r=c.withdrawForm.get("isHistorical"))!=null&&r.value)),s(2),p("ngIf",!((l=c.withdrawForm.get("isHistorical"))!=null&&l.value)),s(),p("ngIf",c.withdrawIrEstimate),s(5),p("ngIf",!((d=c.withdrawForm.get("isHistorical"))!=null&&d.value)),s(2),p("disabled",c.submittingWithdraw),s(),p("ngIf",c.submittingWithdraw),s(),x(" ",(m=c.withdrawForm.get("isHistorical"))!=null&&m.value?"Registrar no hist\xF3rico":"Confirmar resgate"," ")}}function rn(o,t){if(o&1&&(i(0,"div",129)(1,"div",130)(2,"span",10),a(3,"Tipo"),n(),i(4,"span",131),a(5),n()(),i(6,"div",130)(7,"span",10),a(8,"Valor"),n(),i(9,"span"),a(10),b(11,"currency"),n()(),i(12,"div",130)(13,"span",10),a(14,"Data"),n(),i(15,"span"),a(16),n()()()),o&2){let e=t.ngIf,r=u(5);s(5),S(r.movementLabel(e)),s(5),S(C(11,3,I(9,V,e.amount))),s(6),S(r.formatDate(e.date))}}function ln(o,t){o&1&&f(0,"span",112)}function sn(o,t){if(o&1){let e=P();i(0,"div",87),h("click",function(){g(e);let l=u(4);return v(l.closeDeleteMovementModal())}),i(1,"div",88),h("click",function(l){return g(e),v(l.stopPropagation())}),i(2,"div",89)(3,"h6",26),a(4,"Excluir movimenta\xE7\xE3o?"),n(),i(5,"button",90),h("click",function(){g(e);let l=u(4);return v(l.closeDeleteMovementModal())}),a(6," Fechar "),n()(),i(7,"div",37),a(8," Essa a\xE7\xE3o remove apenas este registro do hist\xF3rico do investimento. N\xE3o altera contas nem lan\xE7amentos. "),n(),_(9,rn,17,11,"div",125),i(10,"div",126)(11,"button",127),h("click",function(){g(e);let l=u(4);return v(l.closeDeleteMovementModal())}),a(12," Cancelar "),n(),i(13,"button",128),h("click",function(){g(e);let l=u(4);return v(l.confirmDeleteMovement())}),_(14,ln,1,0,"span",109),a(15," Excluir "),n()()()()}if(o&2){let e=u(4);s(9),p("ngIf",e.movementToDelete),s(4),p("disabled",e.deletingMovement),s(),p("ngIf",e.deletingMovement)}}function cn(o,t){if(o&1){let e=P();N(0),i(1,"div",7)(2,"div")(3,"p",8),a(4,"Patrim\xF4nio"),n(),i(5,"h3",9),a(6),n(),i(7,"div",10),a(8),n()(),i(9,"div",11)(10,"a",12),a(11,"Voltar"),n()()(),i(12,"div",13)(13,"div",14)(14,"h6",15),a(15,"Resumo"),n(),i(16,"div",16)(17,"div",17)(18,"div",18),a(19,"Valor atual estimado"),n(),i(20,"div",19),a(21),b(22,"currency"),n(),i(23,"div",20),a(24),n()(),i(25,"div",17)(26,"div",18),a(27,"Total investido (capital)"),n(),i(28,"div",19),a(29),b(30,"currency"),n(),i(31,"div",20),a(32,"Base no sistema"),n()(),i(33,"div",17)(34,"div",18),a(35,"Rendimento total"),n(),i(36,"div",19),a(37),b(38,"currency"),n(),i(39,"div",20),a(40),b(41,"number"),n()()(),_(42,Ft,2,0,"div",21)(43,Ot,2,0,"div",22),n()(),i(44,"div",23)(45,"div",24)(46,"div",25)(47,"h6",26),a(48,"Acoes"),n(),i(49,"span",27),a(50),n()(),i(51,"div",28)(52,"button",29),h("click",function(){let l=g(e).ngIf,d=u(3);return v(d.openDeposit(l))}),f(53,"i",30),i(54,"span",31),a(55,"Aportar"),n()(),i(56,"button",32),h("click",function(){let l=g(e).ngIf,d=u(3);return v(d.openWithdraw(l))}),f(57,"i",33),i(58,"span",31),a(59,"Resgatar"),n()(),i(60,"button",34),h("click",function(){let l=g(e).ngIf,d=u(3);return v(d.toggleStatus(l))}),_(61,kt,1,0,"span",35),f(62,"i",36),i(63,"span",31),a(64),n()()(),i(65,"div",37),a(66," Edi\xE7\xE3o completa feita na lista de investimentos. "),n()()(),i(67,"div",38)(68,"div",39)(69,"div",40)(70,"div")(71,"h6",41),a(72,"Hist\xF3rico de movimenta\xE7\xF5es"),n(),i(73,"div",10),a(74," Aportes e resgates vinculados as suas contas "),n()(),i(75,"div",42)(76,"div",43)(77,"label",44),a(78,"Tipo"),n(),i(79,"select",45),h("change",function(l){g(e);let d=u(3);return v(d.onFilterTypeChange(l.target.value))}),i(80,"option",46),a(81,"Todos"),n(),i(82,"option",47),a(83,"Aportes"),n(),i(84,"option",48),a(85,"Resgates"),n()()(),i(86,"div",43)(87,"label",44),a(88,"Per\xEDodo"),n(),i(89,"select",45),h("change",function(l){g(e);let d=u(3);return v(d.onFilterPeriodChange(l.target.value))}),i(90,"option",46),a(91,"Tudo"),n(),i(92,"option",49),a(93,"\xDAltimos 30 dias"),n(),i(94,"option",50),a(95,"Este m\xEAs"),n()()()()(),_(96,Ut,3,3,"ng-container",5),b(97,"async"),n()(),_(98,Qt,43,11,"div",51)(99,on,50,24,"div",51)(100,sn,16,3,"div",51),B()}if(o&2){let e=t.ngIf,r=u(3);s(6),S(e.name),s(2),J(" ",e.typeLabel," \u2022 ",e.statusLabel," "),s(13),x(" ",C(22,27,I(50,V,e.totalEstimated))," "),s(3),x(" Atualizado ",e.updatedLabel==="hoje"?"hoje":"em "+e.updatedLabel," "),s(5),x(" ",C(30,33,I(52,V,e.principalBase))," "),s(7),O("text-success",e.totalYield>=0)("text-danger",e.totalYield<0),s(),x(" ",C(38,39,I(54,V,e.totalYield))," "),s(3),x(" ",q(41,45,e.totalReturnPercent,"1.0-2"),"% "),s(2),p("ngIf",e.indexMissing),s(),p("ngIf",e.placeholderUsed),s(6),p("ngClass",Q(56,Tt,e.status==="active",e.status==="inactive")),s(),x(" ",e.statusLabel," "),s(2),p("disabled",e.status==="inactive"),s(4),p("disabled",e.status==="inactive"),s(4),p("disabled",r.togglingStatus),s(),p("ngIf",r.togglingStatus),s(3),x(" ",e.status==="active"?"Inativar":"Ativar"," "),s(15),p("value",r.filterType),s(10),p("value",r.filterPeriod),s(7),p("ngIf",R(97,48,r.history$)),s(2),p("ngIf",r.showDepositModal),s(),p("ngIf",r.showWithdrawModal),s(),p("ngIf",r.showDeleteMovementModal)}}function mn(o,t){if(o&1&&(N(0),_(1,cn,101,59,"ng-container",6),B()),o&2){let e=u().ngIf;u();let r=L(6);s(),p("ngIf",e.view)("ngIfElse",r)}}function dn(o,t){if(o&1&&(N(0),_(1,mn,2,2,"ng-container",6),B()),o&2){let e=t.ngIf;u();let r=L(4);s(),p("ngIf",e.loaded)("ngIfElse",r)}}function pn(o,t){o&1&&(i(0,"div",38)(1,"div",39),f(2,"div",132)(3,"div",133),n()())}function un(o,t){if(o&1&&(i(0,"div",38)(1,"div",39),f(2,"div",132)(3,"div",133),n()(),_(4,pn,4,0,"div",134)),o&2){let e=u();s(4),p("ngForOf",e.skeletonRows)}}function _n(o,t){o&1&&(i(0,"div",38)(1,"div",39),a(2," Investimento n\xE3o encontrado. "),n()())}function gn(o,t){o&1&&(i(0,"div",135),a(1," Nenhuma movimenta\xE7\xE3o registrada ainda. "),n())}var Fe=class o{fb=E(Ie);auth=E(me);route=E(Re);accountsService=E(Ce);categoriesService=E(ce);investmentsService=E(De);movementsService=E(Te);indicesService=E(Me);calculator=E(Ee);notifications=E(Pe);todayYmd=re(new Date);skeletonRows=Array.from({length:3});showDepositModal=!1;showWithdrawModal=!1;submittingDeposit=!1;submittingWithdraw=!1;togglingStatus=!1;showDeleteMovementModal=!1;deletingMovement=!1;movementToDelete=null;selectedInvestment=null;filterType="all";filterPeriod="all";filterTypeSubject=new Oe(this.filterType);filterPeriodSubject=new Oe(this.filterPeriod);typeOptions=[{value:"fixed_income",label:"Renda fixa"},{value:"savings",label:"Poupanca"},{value:"cdb",label:"CDB"},{value:"treasury_selic",label:"Tesouro Selic"},{value:"manual",label:"Manual"}];depositForm=this.fb.group({amount:[null,[w.required,w.min(.01)]],date:[this.todayYmd,w.required],accountId:["",w.required],notes:[""],isHistorical:[!1]});withdrawForm=this.fb.group({amount:[null,[w.required,w.min(.01)]],date:[this.todayYmd,w.required],accountId:["",w.required],notes:[""],isHistorical:[!1],applyIr:[!0]});latestCdi$=this.indicesService.latest$("cdi");latestSelic$=this.indicesService.latest$("selic");investmentId$=this.route.paramMap.pipe(M(t=>t.get("id")),M(t=>t??""));investment$=W([this.auth.user$,this.investmentId$]).pipe(j(([t,e])=>t&&e?this.investmentsService.get$(t.uid,e):D(null)),$(()=>D(null)));view$=W([this.investment$,this.latestCdi$,this.latestSelic$]).pipe(M(([t,e,r])=>t?this.buildView(t,{cdi:e,selic:r}):null));viewState$=this.view$.pipe(M(t=>({view:t,loaded:!0})),Ae({view:null,loaded:!1}));movements$=W([this.auth.user$,this.investmentId$]).pipe(j(([t,e])=>t&&e?this.movementsService.listByInvestment$(t.uid,e):D([])),M(t=>t??[]),z(t=>{if(!Se.production){let e=t[0]??null;console.log("[Investments] movements stream",{count:t.length,first:e})}}),$(()=>D([])));history$=W([this.movements$,this.filterTypeSubject,this.filterPeriodSubject]).pipe(M(([t,e,r])=>this.buildHistory(t,e,r)));accounts$=this.auth.user$.pipe(j(t=>t?this.accountsService.list$(t.uid):D([])),M(t=>t.filter(e=>(e.type??"bank")!=="investment")),$(()=>D([])));trackByMovementId(t,e){return e.id}onFilterTypeChange(t){this.filterType=t||"all",this.filterTypeSubject.next(this.filterType)}onFilterPeriodChange(t){this.filterPeriod=t||"all",this.filterPeriodSubject.next(this.filterPeriod)}openDeposit(t){this.selectedInvestment=t,this.showWithdrawModal=!1,this.showDepositModal=!0,this.depositForm.reset({amount:null,date:this.todayYmd,accountId:"",notes:"",isHistorical:!1}),this.updateHistoricalState(this.depositForm,t)}closeDeposit(){this.showDepositModal=!1,this.selectedInvestment=null}openWithdraw(t){this.selectedInvestment=t,this.showDepositModal=!1,this.showWithdrawModal=!0,this.withdrawForm.reset({amount:null,date:this.todayYmd,accountId:"",notes:"",isHistorical:!1,applyIr:!0}),this.updateHistoricalState(this.withdrawForm,t)}closeWithdraw(){this.showWithdrawModal=!1,this.selectedInvestment=null}onDepositHistoricalToggle(){this.updateHistoricalState(this.depositForm,this.selectedInvestment)}onWithdrawHistoricalToggle(){this.updateHistoricalState(this.withdrawForm,this.selectedInvestment)}get withdrawIrEstimate(){let t=this.selectedInvestment;if(!t||this.withdrawForm.get("isHistorical")?.value||!this.withdrawForm.get("applyIr")?.value)return null;let e=Number(this.withdrawForm.get("amount")?.value??0);if(!Number.isFinite(e)||e<=0)return null;let r=Number(t.totalEstimated??0);if(!Number.isFinite(r)||r<=0)return null;let l=t.realStartDate||t.systemStartDate||"";return this.calculator.calculateRescueIR({principalBase:Number(t.principalBase??0),currentValue:r,rescueAmount:e,investmentStartDate:l})}openDeleteMovement(t){!t.isHistorical||!t.id||(this.movementToDelete=t,this.showDeleteMovementModal=!0)}closeDeleteMovementModal(){this.showDeleteMovementModal=!1,this.movementToDelete=null}async confirmDeleteMovement(){let t=this.movementToDelete;if(!t?.id||!t.isHistorical)return;let e=this.route.snapshot.paramMap.get("id")||"";if(!e)return;let r=await F(this.auth.user$);if(r){this.deletingMovement=!0;try{await this.movementsService.deleteMovement(r.uid,e,t.id),this.notifications.success("Movimenta\xE7\xE3o excluida."),this.closeDeleteMovementModal()}catch{this.notifications.error("N\xE3o foi poss\xEDvel excluir. Tente novamente.")}finally{this.deletingMovement=!1}}}async confirmDeposit(){if(this.depositForm.invalid){this.depositForm.markAllAsTouched(),this.notifications.warning("Preencha os campos obrigat\xF3rios.");return}let t=await F(this.auth.user$),e=this.selectedInvestment;if(!t||!e?.id)return;let r=!!this.depositForm.get("isHistorical")?.value,l=Number(this.depositForm.get("amount")?.value??0);if(!Number.isFinite(l)||l<=0){this.notifications.warning("Informe um valor v\xE1lido.");return}let d=this.depositForm.get("date")?.value||this.todayYmd;if(r){let m=this.validateHistoricalDate(d,e);if(m){this.notifications.warning(m);return}}this.submittingDeposit=!0;try{let m=r?null:await this.categoriesService.ensureCategory(t.uid,{name:"Investimentos",type:"expense",color:"#f97316"});await this.investmentsService.createDeposit(t.uid,{investmentId:e.id,accountId:this.depositForm.get("accountId")?.value||null,amount:l,date:d,categoryId:m,notes:this.depositForm.get("notes")?.value||null,isHistorical:r}),this.notifications.success("Aporte registrado com sucesso."),this.closeDeposit()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.submittingDeposit=!1}}async confirmWithdraw(){if(this.withdrawForm.invalid){this.withdrawForm.markAllAsTouched(),this.notifications.warning("Preencha os campos obrigat\xF3rios.");return}let t=await F(this.auth.user$),e=this.selectedInvestment;if(!t||!e?.id)return;let r=!!this.withdrawForm.get("isHistorical")?.value,l=!!this.withdrawForm.get("applyIr")?.value,d=Number(this.withdrawForm.get("amount")?.value??0);if(!Number.isFinite(d)||d<=0){this.notifications.warning("Informe um valor valido.");return}let m=this.withdrawForm.get("date")?.value||this.todayYmd;if(r){let c=this.validateHistoricalDate(m,e);if(c){this.notifications.warning(c);return}}else{let c=Number(e.totalEstimated??0);if(this.canValidateEstimated(e)&&c>0){let y=c*1.02;if(d>y){this.notifications.warning("Valor acima do estimado do investimento.");return}}else this.notifications.warning("Valor estimado. Verifique antes de confirmar.")}this.submittingWithdraw=!0;try{let c=r?null:await this.resolveWithdrawCategory(t.uid);await this.investmentsService.createWithdraw(t.uid,{investmentId:e.id,accountId:this.withdrawForm.get("accountId")?.value||null,amount:d,date:m,categoryId:c,notes:this.withdrawForm.get("notes")?.value||null,isHistorical:r,applyIr:!r&&l,currentValue:Number(e.totalEstimated??0)}),this.notifications.success("Resgate registrado com sucesso."),this.closeWithdraw()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.submittingWithdraw=!1}}updateHistoricalState(t,e){let r=!!t.get("isHistorical")?.value,l=t.get("accountId");l&&(r?l.clearValidators():l.setValidators([w.required]),l.updateValueAndValidity({emitEvent:!1}));let d=t.get("applyIr");if(d&&(r?(d.setValue(!1,{emitEvent:!1}),d.disable({emitEvent:!1})):d.enable({emitEvent:!1})),r&&e?.systemStartDate){let m=t.get("date"),c=e.systemStartDate,y=m?.value;m&&c&&(!y||y>c)&&m.setValue(c)}}validateHistoricalDate(t,e){if(!t)return"Informe a data do movimento.";if(t>this.todayYmd)return"Movimento hist\xF3rico deve ser no passado.";let r=e?.systemStartDate||e?.realStartDate;return r&&t>r?"Movimento hist\xF3rico deve ser anterior a data de cadastro.":null}async toggleStatus(t){if(!t.id)return;let e=await F(this.auth.user$);if(!e)return;let r=t.status==="active"?"inactive":"active";this.togglingStatus=!0;try{await this.investmentsService.update(e.uid,t.id,{status:r}),this.notifications.success(r==="active"?"Investimento reativado.":"Investimento inativado.")}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.togglingStatus=!1}}movementLabel(t){return t.type==="deposit"?"Aporte":"Resgate"}movementDirectionLabel(t){return t.type==="deposit"?"Saiu de:":"Entrou em:"}movementAccountLabel(t){return t.accountNameSnapshot||"Conta removida"}movementHistoricalAccountLabel(t){return t.accountNameSnapshot?`Conta: ${t.accountNameSnapshot}`:"Conta: - (movimento hist\xF3rico)"}formatDate(t){return G(t)}buildView(t,e){let r=this.calculator.calculate(t,e),l=t.lastYieldCalculationAt||r.updatedAt,d=this.buildUpdatedLabel(l);return H(A(A({},t),r),{typeLabel:this.typeLabel(t.type),statusLabel:t.status==="active"?"Ativo":"Inativo",updatedLabel:d})}buildHistory(t,e,r){let l=t.filter(y=>!y.isHistorical),d=l.filter(y=>y.type==="deposit").reduce((y,T)=>y+Number(T.amount??0),0),m=l.filter(y=>y.type==="withdraw").reduce((y,T)=>y+Number(T.amount??0),0);return{items:t.filter(y=>e!=="all"&&y.type!==e?!1:this.matchesPeriod(y,r)),totalDeposits:d,totalWithdraws:m,hasMovements:t.length>0}}matchesPeriod(t,e){if(e==="all")return!0;let r=le(t.date);if(!r)return!1;let l=new Date,d=new Date(l.getFullYear(),l.getMonth(),l.getDate());if(e==="last_30"){let m=new Date(d);return m.setDate(m.getDate()-29),r>=m&&r<=d}return r.getFullYear()===d.getFullYear()&&r.getMonth()===d.getMonth()}typeLabel(t){return this.typeOptions.find(r=>r.value===t)?.label??"Manual"}canValidateEstimated(t){return!t.indexMissing&&!t.placeholderUsed}async resolveWithdrawCategory(t){let e=await F(this.categoriesService.list$(t)),r=c=>c.trim().toLowerCase(),l=e.filter(c=>c.type==="income"),d=l.find(c=>r(c.name)==="resgates");if(d?.id)return d.id;let m=l.find(c=>r(c.name)==="investimentos");return m?.id?m.id:this.categoriesService.ensureCategory(t,{name:"Resgates",type:"income",color:"#22c55e"})}buildUpdatedLabel(t){if(!t)return"-";let e=se(new Date);return t===e?"hoje":G(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=K({type:o,selectors:[["app-investment-detail"]],decls:9,vars:3,consts:[["loadingTpl",""],["missingTpl",""],["emptyMovementsTpl",""],["historicalAccountTpl",""],[1,"row","g-3","investment-detail"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"col-12","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"text-uppercase","text-primary","small","mb-1"],[1,"fw-bold","mb-0"],[1,"text-secondary","small"],[1,"d-flex","gap-2"],["routerLink","/app/investments",1,"btn","btn-sm","btn-outline-light"],[1,"col-lg-7"],[1,"glass-card","p-3","h-100"],[1,"fw-semibold","mb-3"],[1,"summary-grid"],[1,"glass-card","summary-card"],[1,"summary-label"],[1,"summary-value"],[1,"summary-sub"],["class","text-warning small mt-2",4,"ngIf"],["class","text-secondary small mt-1",4,"ngIf"],[1,"col-lg-5"],[1,"glass-card","p-3","h-100","actions-card"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"fw-semibold","mb-0"],[1,"badge",3,"ngClass"],[1,"actions-grid"],["type","button",1,"btn","btn-sm","btn-outline-success","action-btn",3,"click","disabled"],[1,"bi","bi-plus-circle"],[1,"action-label"],["type","button",1,"btn","btn-sm","btn-outline-warning","action-btn",3,"click","disabled"],[1,"bi","bi-dash-circle"],["type","button",1,"btn","btn-sm","btn-outline-danger","action-btn","action-btn--danger",3,"click","disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],[1,"bi","bi-power"],[1,"text-secondary","small","mt-2"],[1,"col-12"],[1,"glass-card","p-3"],[1,"history-header"],[1,"fw-semibold","mb-1"],[1,"history-filters"],[1,"filter-field"],[1,"form-label","text-secondary","small"],[1,"form-select","form-select-sm",3,"change","value"],["value","all"],["value","deposit"],["value","withdraw"],["value","last_30"],["value","this_month"],["class","modal-backdrop",3,"click",4,"ngIf"],[1,"text-warning","small","mt-2"],[1,"text-secondary","small","mt-1"],[1,"spinner-border","spinner-border-sm","me-1"],["class","history-totals",4,"ngIf"],["class","movement-list",4,"ngIf","ngIfElse"],[1,"history-totals"],[1,"total-card"],[1,"total-label"],[1,"total-value"],[1,"movement-list"],["class","movement-row",4,"ngFor","ngForOf","ngForTrackBy"],[1,"movement-row"],[1,"movement-icon"],["class","bi bi-plus",4,"ngIf"],["class","bi bi-dash",4,"ngIf"],[1,"movement-body"],[1,"movement-title"],["class","movement-badge",4,"ngIf"],[1,"movement-meta"],[1,"dot"],["class","movement-ir",4,"ngIf"],["class","movement-historical-note",4,"ngIf"],["class","movement-note",4,"ngIf"],["class","movement-related",4,"ngIf"],[1,"movement-amount"],[1,"movement-actions"],["type","button",1,"btn","btn-sm","btn-outline-danger","movement-delete-btn",3,"click","disabled"],[1,"bi","bi-trash"],[1,"bi","bi-plus"],[1,"bi","bi-dash"],[1,"movement-badge"],[1,"movement-ir"],[1,"movement-historical-note"],[1,"movement-note"],[1,"movement-related"],[1,"modal-backdrop",3,"click"],[1,"glass-card","modal-card",3,"click"],[1,"modal-header-row"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],[1,"d-grid","gap-3","mt-3",3,"ngSubmit","formGroup"],[1,"form-label","text-secondary"],["type","number","formControlName","amount","step","0.01","placeholder","Ex: 1.000,00",1,"form-control","glass-input"],[1,"form-grid-fixed"],[1,"form-field"],["type","date","formControlName","date",1,"form-control","glass-input"],[1,"form-field","account-field"],["formControlName","accountId",1,"form-select"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"historical-block"],[1,"historical-toggle"],[1,"form-check","form-switch"],["type","checkbox","formControlName","isHistorical","id","detail-deposit-historical-toggle",1,"form-check-input","toggle-switch",3,"change"],["for","detail-deposit-historical-toggle",1,"form-check-label","toggle-label"],[1,"text-secondary","historical-helper"],["formControlName","notes","placeholder","Opcional",1,"form-control","glass-input"],["type","submit",1,"btn","btn-primary","flex-grow-1",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["type","button",1,"btn","btn-outline-light",3,"click"],[3,"value"],[1,"spinner-border","spinner-border-sm","me-2"],["class","text-warning small",4,"ngIf"],["type","checkbox","formControlName","isHistorical","id","detail-withdraw-historical-toggle",1,"form-check-input","toggle-switch",3,"change"],["for","detail-withdraw-historical-toggle",1,"form-check-label","toggle-label"],["class","ir-preview",4,"ngIf"],["class","text-secondary small",4,"ngIf"],[1,"text-warning","small"],[1,"form-check"],["type","checkbox","formControlName","applyIr","id","detail-withdraw-ir-toggle",1,"form-check-input"],["for","detail-withdraw-ir-toggle",1,"form-check-label"],[1,"text-secondary"],[1,"ir-preview"],[1,"ir-row"],["class","movement-delete-summary mt-3",4,"ngIf"],[1,"d-flex","gap-2","mt-3"],["type","button",1,"btn","btn-outline-light","flex-grow-1",3,"click"],["type","button",1,"btn","btn-danger","flex-grow-1",3,"click","disabled"],[1,"movement-delete-summary","mt-3"],[1,"d-flex","justify-content-between"],[1,"fw-semibold"],[1,"skeleton","skeleton-line","w-50","mb-2"],[1,"skeleton","skeleton-line","w-75"],["class","col-12",4,"ngFor","ngForOf"],[1,"empty-state"]],template:function(e,r){e&1&&(i(0,"div",4),_(1,dn,2,2,"ng-container",5),b(2,"async"),_(3,un,5,1,"ng-template",null,0,Y)(5,_n,3,0,"ng-template",null,1,Y)(7,gn,2,0,"ng-template",null,2,Y),n()),e&2&&(s(),p("ngIf",R(2,1,r.viewState$)))},dependencies:[ae,X,Z,ee,we,ge,be,ye,pe,ve,de,xe,ue,_e,he,fe,oe,te,ne,ie],styles:[".summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}.summary-card[_ngcontent-%COMP%]{padding:14px;display:flex;flex-direction:column;gap:6px;min-height:110px}.summary-label[_ngcontent-%COMP%]{font-size:.7rem;letter-spacing:.14em;text-transform:uppercase;color:var(--app-muted)}.summary-value[_ngcontent-%COMP%]{font-size:1.35rem;font-weight:600}.summary-sub[_ngcontent-%COMP%]{font-size:.8rem;color:var(--app-muted)}.actions-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.actions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}.action-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:6px;border-radius:12px;padding:6px 10px}.action-btn--danger[_ngcontent-%COMP%]{border-color:#f8717180;color:#fca5a5}.action-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600}.form-grid-fixed[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.form-grid-fixed[_ngcontent-%COMP%]   .account-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{min-height:40px;display:flex;align-items:flex-end}.form-grid-fixed[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{min-height:38px;display:flex;align-items:flex-end}.historical-block[_ngcontent-%COMP%]{margin-top:10px}.historical-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.historical-toggle[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin:0}.historical-toggle[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin:0}.historical-toggle[_ngcontent-%COMP%]   .toggle-label[_ngcontent-%COMP%]{flex:1;margin:0;line-height:1.3}.historical-toggle[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]{flex-shrink:0}.historical-helper[_ngcontent-%COMP%]{display:block;min-height:18px;margin-left:34px;opacity:.75;transition:opacity .2s ease}.historical-helper--hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.history-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}.history-filters[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}.filter-field[_ngcontent-%COMP%]{min-width:150px}.history-totals[_ngcontent-%COMP%]{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}.total-card[_ngcontent-%COMP%]{padding:12px;border-radius:14px;background:#0f172a59;border:1px solid rgba(148,163,184,.12)}.total-label[_ngcontent-%COMP%]{font-size:.7rem;text-transform:uppercase;letter-spacing:.12em;color:var(--app-muted)}.total-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600}.movement-list[_ngcontent-%COMP%]{margin-top:16px;display:flex;flex-direction:column;gap:12px}.movement-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto auto;gap:12px;align-items:center;padding:12px;border-radius:16px;background:#0f172a59;border:1px solid rgba(148,163,184,.12)}.movement-icon[_ngcontent-%COMP%]{width:38px;height:38px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;background:#94a3b81f;color:#e2e8f0}.movement-icon.deposit[_ngcontent-%COMP%]{background:#22c55e2e;color:#bbf7d0}.movement-icon.withdraw[_ngcontent-%COMP%]{background:#f59e0b2e;color:#fde68a}.movement-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.movement-title[_ngcontent-%COMP%]{font-weight:600;display:flex;align-items:center;gap:8px}.movement-meta[_ngcontent-%COMP%], .movement-ir[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;flex-wrap:wrap;font-size:.8rem;color:var(--app-muted)}.dot[_ngcontent-%COMP%]{opacity:.6}.movement-note[_ngcontent-%COMP%]{font-size:.85rem;color:#cbd5f5}.movement-related[_ngcontent-%COMP%]{font-size:.75rem;color:var(--app-muted)}.movement-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:999px;font-size:.65rem;letter-spacing:.08em;text-transform:uppercase;background:#94a3b826;border:1px solid rgba(148,163,184,.25);color:#e2e8f0}.movement-historical-note[_ngcontent-%COMP%]{font-size:.75rem;color:var(--app-muted)}.movement-amount[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}.movement-amount.positive[_ngcontent-%COMP%]{color:#bbf7d0}.movement-amount.negative[_ngcontent-%COMP%]{color:#fecaca}.movement-delete-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.movement-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.movement-delete-btn[_ngcontent-%COMP%]{border-radius:10px;padding:4px 8px}.ir-preview[_ngcontent-%COMP%]{padding:12px;border-radius:14px;background:#0f172a59;border:1px solid rgba(148,163,184,.12);display:grid;gap:6px}.ir-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;font-size:.85rem;color:var(--app-muted)}.ir-row[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e2e8f0}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#070a14a6;display:flex;align-items:center;justify-content:center;padding:16px;z-index:1050}.modal-card[_ngcontent-%COMP%]{width:min(520px,100%);padding:20px;border-radius:18px}.modal-header-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}@media(max-width:768px){.form-grid-fixed[_ngcontent-%COMP%]{grid-template-columns:1fr}.historical-helper[_ngcontent-%COMP%]{margin-left:0}.movement-row[_ngcontent-%COMP%]{grid-template-columns:1fr;align-items:flex-start}.movement-amount[_ngcontent-%COMP%]{justify-self:flex-start}}"]})};var vi=[{path:":id",component:Fe},{path:"",component:Ve,pathMatch:"full"}];export{vi as INVESTMENTS_ROUTES};
