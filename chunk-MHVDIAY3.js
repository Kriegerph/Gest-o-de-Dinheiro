import{$a as S,Ac as xe,Ba as u,Bb as X,Cb as Z,Db as ee,Eb as te,Ec as he,F as $,Ga as K,Gb as ne,Gc as be,H as L,Ha as m,Hb as ie,Hc as ye,Ia as i,Ib as ae,Ic as Ie,Ja as n,Jc as Se,Ka as p,Kc as Ce,Lc as we,O as I,Oa as W,Pa as z,Qa as P,Ra as _,T as v,Ta as d,U as g,Xa as q,Za as O,_a as a,a as M,ab as f,b as R,gb as C,hb as Q,hc as oe,ic as U,kb as y,kc as re,lb as k,lc as le,m as V,mb as j,mc as se,nb as w,nc as me,ob as G,oc as b,pa as l,pc as de,q as T,qc as ce,r as A,s as H,tc as pe,uc as ue,wc as ve,xc as ge,y as N,yc as _e,za as J,zc as fe}from"./chunk-YQTRLNFP.js";var E=o=>[o,"BRL","symbol","1.2-2","pt-BR"],Ee=(o,t)=>({"bg-success-subtle text-success":o,"bg-secondary-subtle text-secondary":t});function Pe(o,t){if(o&1){let e=P();i(0,"button",10),_("click",function(){v(e);let r=d();return g(r.resetForm())}),a(1," Cancelar edi\xE7\xE3o "),n()}}function Ve(o,t){o&1&&(i(0,"div",11)(1,"div",49),a(2," Sem \xEDndice atualizado para investimentos indexados. "),n()())}function Te(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;m("value",e.value),l(),S(e.label)}}function Me(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;m("value",e.value),l(),S(e.label)}}function Ae(o,t){o&1&&(i(0,"div")(1,"label",23),a(2,"Valor aplicado inicial"),n(),p(3,"input",51),n())}function Ne(o,t){o&1&&(i(0,"div",52)(1,"div",28)(2,"div",29)(3,"label",23),a(4,"Data de alinhamento"),n(),p(5,"input",53),n(),i(6,"div",29)(7,"label",23),a(8,"Valor atual"),n(),p(9,"input",54),n()(),i(10,"div",28)(11,"div",29)(12,"label",23),a(13,"Total investido at\xE9 hoje"),n(),p(14,"input",55),n(),i(15,"div",29)(16,"label",23),a(17,"Rendimento acumulado at\xE9 hoje"),n(),p(18,"input",56),n()(),i(19,"small",27),a(20," Valores anteriores ao app servem para alinhar seu hist\xF3rico. O app n\xE3o recalcula o passado. "),n()())}function Oe(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;m("value",e.value),l(),S(e.label)}}function ke(o,t){if(o&1&&(i(0,"div",28)(1,"div",29)(2,"label",23),a(3),n(),p(4,"input",57),n()()),o&2){let e=d(2);l(3),S(e.manualRateLabel)}}function De(o,t){o&1&&(i(0,"div",29)(1,"label",23),a(2,"% do CDI"),n(),p(3,"input",60),n())}function Fe(o,t){if(o&1&&(i(0,"div",28),u(1,De,4,0,"div",58),i(2,"div")(3,"label",23),a(4,"Taxa placeholder (a.m.)"),n(),p(5,"input",59),n()()),o&2){let e=d(2);l(),m("ngIf",e.yieldMode==="cdi_percent"),l(),O("col-6",e.yieldMode==="cdi_percent")("col-12",e.yieldMode!=="cdi_percent")}}function Be(o,t){o&1&&p(0,"span",61)}function Ye(o,t){if(o&1&&(i(0,"div",64),a(1),y(2,"currency"),n()),o&2){let e=d().$implicit;l(),f(" Rendimento pre-app: ",w(2,1,C(7,E,e.preAppYield))," ")}}function Re(o,t){o&1&&(i(0,"div",83),a(1," Sem \xEDndice atualizado "),n())}function $e(o,t){o&1&&(i(0,"div",64),a(1," Taxa placeholder aplicada "),n())}function Le(o,t){o&1&&(i(0,"div",64),a(1," Total (inclui antes do app) "),n())}function We(o,t){o&1&&p(0,"span",84)}function ze(o,t){if(o&1){let e=P();i(0,"tr")(1,"td")(2,"div",63),a(3),n(),i(4,"div",64),a(5),n(),u(6,Ye,3,9,"div",65),n(),i(7,"td",48)(8,"div",63),a(9),y(10,"currency"),n(),i(11,"div",64),a(12,"Base no sistema"),n()(),i(13,"td",48)(14,"div",63),a(15),y(16,"currency"),n(),i(17,"div",64),a(18,"Estimado"),n(),u(19,Re,2,0,"div",66)(20,$e,2,0,"div",65),i(21,"div",64),a(22),n()(),i(23,"td",48)(24,"div",63),a(25),y(26,"currency"),n(),i(27,"div",64),a(28),y(29,"number"),n(),u(30,Le,2,0,"div",65),n(),i(31,"td")(32,"span",67),a(33),n()(),i(34,"td",68)(35,"div",69)(36,"div",70)(37,"button",71),_("click",function(){let r=v(e).$implicit,c=d(3);return g(c.openDeposit(r))}),p(38,"i",72),i(39,"span",73),a(40,"Aportar"),n()(),i(41,"button",74),_("click",function(){let r=v(e).$implicit,c=d(3);return g(c.openWithdraw(r))}),p(42,"i",75),i(43,"span",73),a(44,"Resgatar"),n()()(),i(45,"div",76)(46,"button",77),_("click",function(){let r=v(e).$implicit,c=d(3);return g(c.edit(r))}),p(47,"i",78),i(48,"span",79),a(49,"Editar"),n()(),i(50,"button",80),_("click",function(){let r=v(e).$implicit,c=d(3);return g(c.toggleStatus(r))}),u(51,We,1,0,"span",81),p(52,"i",82),i(53,"span",79),a(54),n()()()()()()}if(o&2){let e=t.$implicit,s=d(3);l(3),S(e.name),l(2),S(e.typeLabel),l(),m("ngIf",e.hadBeforeApp),l(3),f(" ",w(10,23,C(44,E,e.principalBase))," "),l(6),f(" ",w(16,29,C(46,E,e.totalEstimated))," "),l(4),m("ngIf",e.indexMissing),l(),m("ngIf",e.placeholderUsed),l(2),f("Atualizado em ",e.updatedLabel),l(2),O("text-success",e.totalYield>=0)("text-danger",e.totalYield<0),l(),f(" ",w(26,35,C(48,E,e.totalYield))," "),l(3),f("",j(29,41,e.totalReturnPercent,"1.0-2"),"%"),l(2),m("ngIf",e.hadBeforeApp),l(2),m("ngClass",Q(50,Ee,e.status==="active",e.status==="inactive")),l(),f(" ",e.statusLabel," "),l(4),m("disabled",e.status==="inactive"),l(4),m("disabled",e.status==="inactive"),l(9),m("disabled",s.togglingId===e.id),K("title",e.status==="active"?"Inativar investimento":"Ativar investimento"),l(),m("ngIf",s.togglingId===e.id),l(3),f(" ",e.status==="active"?"Inativar":"Ativar"," ")}}function qe(o,t){if(o&1&&(W(0),u(1,ze,55,53,"tr",62),z()),o&2){let e=d().ngIf,s=d();l(),m("ngForOf",e.items)("ngForTrackBy",s.trackById)}}function je(o,t){if(o&1){let e=P();i(0,"tr")(1,"td",85)(2,"div",86)(3,"div"),a(4,"Nenhum investimento cadastrado."),n(),i(5,"button",87),_("click",function(){v(e);let r=d(2);return g(r.resetForm())}),a(6," Novo investimento "),n()()()()}}function Ge(o,t){if(o&1){let e=P();W(0),i(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),a(5,"Total investido"),n(),i(6,"div",15),a(7),y(8,"currency"),n(),i(9,"div",16),a(10,"Capital aplicado"),n()(),i(11,"div",13)(12,"div",14),a(13,"Total atual estimado"),n(),i(14,"div",15),a(15),y(16,"currency"),n(),i(17,"div",16),a(18,"Capital + rendimentos"),n()(),i(19,"div",13)(20,"div",14),a(21,"Rendimento"),n(),i(22,"div",15),a(23),y(24,"currency"),n(),i(25,"div",16),a(26),y(27,"number"),n()(),i(28,"div",13)(29,"div",14),a(30,"Atualizado em"),n(),i(31,"div",15),a(32),n(),i(33,"div",17),a(34,"Estimado"),n()()()(),u(35,Ve,3,0,"div",18),i(36,"div",19)(37,"div",20)(38,"h6",21),a(39),n(),i(40,"form",22),_("ngSubmit",function(){v(e);let r=d();return g(r.save())}),i(41,"div")(42,"label",23),a(43,"Nome"),n(),p(44,"input",24),n(),i(45,"div")(46,"label",23),a(47,"Tipo"),n(),i(48,"select",25),_("change",function(){v(e);let r=d();return g(r.onTypeChange())}),u(49,Te,2,2,"option",26),n(),i(50,"small",27),a(51," Ex: Caixinha Nubank = Renda fixa + % do CDI (100) + capitaliza\xE7\xE3o di\xE1ria. "),n()(),i(52,"div",28)(53,"div",29)(54,"label",23),a(55,"Data de inicio real"),n(),p(56,"input",30),n(),i(57,"div",29)(58,"label",23),a(59,"Status"),n(),i(60,"select",31),u(61,Me,2,2,"option",26),n()()(),i(62,"div",32)(63,"input",33),_("change",function(){v(e);let r=d();return g(r.onBeforeAppToggle())}),n(),i(64,"label",34),a(65," Investimento ja existia antes do app? "),n()(),u(66,Ae,4,0,"div",35)(67,Ne,21,0,"div",36),i(68,"div")(69,"label",23),a(70,"Regra de rendimento"),n(),i(71,"select",37),_("change",function(){v(e);let r=d();return g(r.onYieldModeChange())}),u(72,Oe,2,2,"option",26),n()(),u(73,ke,5,1,"div",38)(74,Fe,6,5,"div",38),i(75,"div",28)(76,"div")(77,"label",23),a(78,"Capitaliza\xE7\xE3o"),n(),i(79,"select",39)(80,"option",40),a(81,"Mensal"),n(),i(82,"option",41),a(83,"Di\xE1ria"),n()()()(),i(84,"div",6)(85,"button",42),u(86,Be,1,0,"span",43),a(87),n(),i(88,"button",44),_("click",function(){v(e);let r=d();return g(r.resetForm())}),a(89,"Limpar"),n()()()()(),i(90,"div",45)(91,"div",20)(92,"div",46)(93,"table",47)(94,"thead")(95,"tr",27)(96,"th"),a(97,"Investimento"),n(),i(98,"th",48),a(99,"Base"),n(),i(100,"th",48),a(101,"Atual estimado"),n(),i(102,"th",48),a(103,"Rendimento"),n(),i(104,"th"),a(105,"Status"),n(),i(106,"th",48),a(107,"A\xE7\xF5es"),n()()(),i(108,"tbody"),u(109,qe,2,2,"ng-container",8),n(),u(110,je,7,0,"ng-template",null,1,G),n()()()(),z()}if(o&2){let e=t.ngIf,s=q(111),r=d();l(7),f(" ",w(8,24,C(45,E,e.summary.totalInvested))," "),l(8),f(" ",w(16,30,C(47,E,e.summary.totalEstimated))," "),l(8),f(" ",w(24,36,C(49,E,e.summary.totalYield))," "),l(3),f(" Rentabilidade: ",j(27,42,e.summary.totalYieldPercent,"1.0-2"),"% "),l(6),S(e.summary.updatedLabel),l(3),m("ngIf",e.summary.indexMissing),l(4),S(r.editingId?"Editar investimento":"Novo investimento"),l(),m("formGroup",r.form),l(9),m("ngForOf",r.typeOptions),l(12),m("ngForOf",r.statusOptions),l(5),m("ngIf",!r.isBeforeApp),l(),m("ngIf",r.isBeforeApp),l(5),m("ngForOf",r.yieldOptions),l(),m("ngIf",r.isManualMode),l(),m("ngIf",r.isIndexMode),l(2),O("col-6",r.isManualMode)("col-12",r.isIndexMode),l(9),m("disabled",r.saving),l(),m("ngIf",r.saving),l(),f(" ",r.saving?"Salvando...":r.editingId?"Salvar altera\xE7\xF5es":"Adicionar"," "),l(22),m("ngIf",e.items.length>0)("ngIfElse",s)}}function Ue(o,t){o&1&&(i(0,"div",11)(1,"div",88),p(2,"div",89)(3,"div",90),n()())}function He(o,t){if(o&1&&(i(0,"div",11)(1,"div",88),p(2,"div",89)(3,"div",90),n()(),u(4,Ue,4,0,"div",91)),o&2){let e=d();l(4),m("ngForOf",e.skeletonRows)}}function Je(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;m("value",e.id),l(),f(" ",e.name," ")}}function Ke(o,t){o&1&&p(0,"span",61)}function Qe(o,t){if(o&1){let e=P();i(0,"div",92),_("click",function(){v(e);let r=d();return g(r.closeDeposit())}),i(1,"div",93),_("click",function(r){return v(e),g(r.stopPropagation())}),i(2,"div",94)(3,"h6",95),a(4),n(),i(5,"button",10),_("click",function(){v(e);let r=d();return g(r.closeDeposit())}),a(6,"Fechar"),n()(),i(7,"form",96),_("ngSubmit",function(){v(e);let r=d();return g(r.confirmDeposit())}),i(8,"div")(9,"label",23),a(10,"Valor"),n(),p(11,"input",97),n(),i(12,"div",28)(13,"div",29)(14,"label",23),a(15,"Data"),n(),p(16,"input",98),n(),i(17,"div",29)(18,"label",23),a(19,"Conta de origem"),n(),i(20,"select",99)(21,"option",100),a(22,"Selecione..."),n(),u(23,Je,2,2,"option",26),y(24,"async"),n()()(),i(25,"div")(26,"label",23),a(27,"Observa\xE7\xE3o"),n(),p(28,"input",101),n(),i(29,"div",6)(30,"button",42),u(31,Ke,1,0,"span",43),a(32," Confirmar aporte "),n(),i(33,"button",44),_("click",function(){v(e);let r=d();return g(r.closeDeposit())}),a(34,"Cancelar"),n()()()()()}if(o&2){let e=d();l(4),f("Aportar em ",e.selectedInvestment==null?null:e.selectedInvestment.name),l(3),m("formGroup",e.depositForm),l(16),m("ngForOf",k(24,5,e.accounts$)),l(7),m("disabled",e.submittingDeposit),l(),m("ngIf",e.submittingDeposit)}}function Xe(o,t){o&1&&(i(0,"div",83),a(1," Valor estimado. Sem indice atualizado. "),n())}function Ze(o,t){if(o&1&&(i(0,"option",50),a(1),n()),o&2){let e=t.$implicit;m("value",e.id),l(),f(" ",e.name," ")}}function et(o,t){o&1&&p(0,"span",61)}function tt(o,t){if(o&1){let e=P();i(0,"div",92),_("click",function(){v(e);let r=d();return g(r.closeWithdraw())}),i(1,"div",93),_("click",function(r){return v(e),g(r.stopPropagation())}),i(2,"div",94)(3,"h6",95),a(4),n(),i(5,"button",10),_("click",function(){v(e);let r=d();return g(r.closeWithdraw())}),a(6,"Fechar"),n()(),i(7,"div",102),a(8),y(9,"currency"),n(),u(10,Xe,2,0,"div",66),i(11,"form",96),_("ngSubmit",function(){v(e);let r=d();return g(r.confirmWithdraw())}),i(12,"div")(13,"label",23),a(14,"Valor"),n(),p(15,"input",97),n(),i(16,"div",28)(17,"div",29)(18,"label",23),a(19,"Data"),n(),p(20,"input",98),n(),i(21,"div",29)(22,"label",23),a(23,"Conta de destino"),n(),i(24,"select",99)(25,"option",100),a(26,"Selecione..."),n(),u(27,Ze,2,2,"option",26),y(28,"async"),n()()(),i(29,"div")(30,"label",23),a(31,"Observa\xE7\xE3o"),n(),p(32,"input",101),n(),i(33,"div",6)(34,"button",42),u(35,et,1,0,"span",43),a(36," Confirmar resgate "),n(),i(37,"button",44),_("click",function(){v(e);let r=d();return g(r.closeWithdraw())}),a(38,"Cancelar"),n()()()()()}if(o&2){let e=d();l(4),f("Resgatar de ",e.selectedInvestment==null?null:e.selectedInvestment.name),l(4),f(" Valor estimado atual: ",w(9,7,C(15,E,e.selectedInvestment==null?null:e.selectedInvestment.totalEstimated))," "),l(2),m("ngIf",e.selectedInvestment==null?null:e.selectedInvestment.indexMissing),l(),m("formGroup",e.withdrawForm),l(16),m("ngForOf",k(28,13,e.accounts$)),l(7),m("disabled",e.submittingWithdraw),l(),m("ngIf",e.submittingWithdraw)}}var D=class o{fb=I(he);auth=I(le);accountsService=I(ye);categoriesService=I(re);investmentsService=I(Ie);indicesService=I(Ce);calculator=I(Se);notifications=I(we);todayYmd=oe(new Date);skeletonRows=Array.from({length:4});editingId=null;saving=!1;togglingId=null;loadingInvestments=!0;showDepositModal=!1;showWithdrawModal=!1;submittingDeposit=!1;submittingWithdraw=!1;selectedInvestment=null;typeOptions=[{value:"fixed_income",label:"Renda fixa"},{value:"savings",label:"Poupan\xE7a"},{value:"cdb",label:"CDB"},{value:"treasury_selic",label:"Tesouro Selic"},{value:"manual",label:"Manual"}];yieldOptions=[{value:"manual_monthly",label:"Manual (a.m.)"},{value:"manual_yearly",label:"Manual (a.a.)"},{value:"cdi_percent",label:"% do CDI"},{value:"selic",label:"Selic"}];statusOptions=[{value:"active",label:"Ativo"},{value:"inactive",label:"Inativo"}];form=this.fb.group({name:["",[b.required,b.minLength(2)]],type:["savings",b.required],realStartDate:[this.todayYmd,b.required],status:["active",b.required],hadBeforeApp:[!1],systemStartDate:[this.todayYmd],currentValueAtOnboarding:[null],totalInvestedToDate:[null],preAppYield:[null],principalBase:[0,[b.min(0)]],yieldMode:["manual_monthly",b.required],manualRate:[0],cdiPercent:[100],compounding:["monthly"]});depositForm=this.fb.group({amount:[null,[b.required,b.min(.01)]],date:[this.todayYmd,b.required],accountId:["",b.required],notes:[""]});withdrawForm=this.fb.group({amount:[null,[b.required,b.min(.01)]],date:[this.todayYmd,b.required],accountId:["",b.required],notes:[""]});latestCdi$=this.indicesService.latest$("cdi");latestSelic$=this.indicesService.latest$("selic");investments$=this.auth.user$.pipe(L(()=>this.loadingInvestments=!0),$(t=>t?this.investmentsService.list$(t.uid):V([])),A(t=>t??[]),N(()=>V([])));accounts$=this.auth.user$.pipe($(t=>t?this.accountsService.list$(t.uid):V([])),A(t=>t.filter(e=>(e.type??"bank")!=="investment")),N(()=>V([])));view$=H([this.investments$,this.latestCdi$,this.latestSelic$]).pipe(A(([t,e,s])=>this.buildView(t,{cdi:e,selic:s})),L(()=>this.loadingInvestments=!1),N(()=>(this.loadingInvestments=!1,V(this.emptyView()))));get isBeforeApp(){return!!this.form.get("hadBeforeApp")?.value}get yieldMode(){return this.form.get("yieldMode")?.value}get isManualMode(){return this.yieldMode==="manual_monthly"||this.yieldMode==="manual_yearly"}get isIndexMode(){return this.yieldMode==="cdi_percent"||this.yieldMode==="selic"}get manualRateLabel(){return this.yieldMode==="manual_yearly"?"Taxa a.a. (%)":"Taxa a.m. (%)"}trackById(t,e){return e.id}onBeforeAppToggle(){this.isBeforeApp?this.form.get("systemStartDate")?.value||this.form.patchValue({systemStartDate:this.todayYmd}):this.form.patchValue({systemStartDate:this.form.get("realStartDate")?.value||this.todayYmd,currentValueAtOnboarding:null,totalInvestedToDate:null,preAppYield:null})}onYieldModeChange(){this.form.patchValue({compounding:this.isIndexMode?"daily":"monthly"})}onTypeChange(){let t=this.form.get("type")?.value;this.editingId||t!=="fixed_income"||this.hasYieldOverrides()||this.form.patchValue({yieldMode:"cdi_percent",cdiPercent:100,compounding:"daily"})}edit(t){let e=t.currentValueAtOnboarding??Number(t.principalBase??0)+Number(t.preAppYield??0);this.editingId=t.id||null,this.form.patchValue({name:t.name,type:t.type,realStartDate:t.realStartDate,status:t.status,hadBeforeApp:t.hadBeforeApp,systemStartDate:t.systemStartDate,currentValueAtOnboarding:e,totalInvestedToDate:t.totalInvestedToDate??null,preAppYield:t.preAppYield??null,principalBase:t.principalBase??0,yieldMode:t.yieldMode,manualRate:t.manualRate??0,cdiPercent:t.cdiPercent??100,compounding:t.compounding??(t.yieldMode==="cdi_percent"||t.yieldMode==="selic"?"daily":"monthly")})}resetForm(){this.editingId=null,this.form.reset({name:"",type:"savings",realStartDate:this.todayYmd,status:"active",hadBeforeApp:!1,systemStartDate:this.todayYmd,currentValueAtOnboarding:null,totalInvestedToDate:null,preAppYield:null,principalBase:0,yieldMode:"manual_monthly",manualRate:0,cdiPercent:100,compounding:"monthly"})}async save(){let t=this.validateForm();if(t){this.notifications.warning(t);return}let e=await T(this.auth.user$);if(!e)return;let s=this.buildPayload();this.saving=!0;try{this.editingId?await this.investmentsService.update(e.uid,this.editingId,s):await this.investmentsService.add(e.uid,s),this.notifications.success("Salvo com sucesso."),this.resetForm()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.saving=!1}}async toggleStatus(t){if(!t.id)return;let e=await T(this.auth.user$);if(!e)return;let s=t.status==="active"?"inactive":"active";this.togglingId=t.id;try{await this.investmentsService.update(e.uid,t.id,{status:s}),this.notifications.success(s==="active"?"Investimento reativado.":"Investimento inativado.")}catch{this.notifications.error("Nao foi poss\xEDvel conclu\xEDr. Tente novamente.")}finally{this.togglingId===t.id&&(this.togglingId=null)}}openDeposit(t){this.selectedInvestment=t,this.showWithdrawModal=!1,this.showDepositModal=!0,this.depositForm.reset({amount:null,date:this.todayYmd,accountId:"",notes:""})}closeDeposit(){this.showDepositModal=!1,this.selectedInvestment=null}openWithdraw(t){this.selectedInvestment=t,this.showDepositModal=!1,this.showWithdrawModal=!0,this.withdrawForm.reset({amount:null,date:this.todayYmd,accountId:"",notes:""})}closeWithdraw(){this.showWithdrawModal=!1,this.selectedInvestment=null}async confirmDeposit(){if(this.depositForm.invalid){this.depositForm.markAllAsTouched(),this.notifications.warning("Preencha os campos obrigat\xF3rios.");return}let t=await T(this.auth.user$),e=this.selectedInvestment;if(!t||!e?.id)return;let s=Number(this.depositForm.get("amount")?.value??0);if(!Number.isFinite(s)||s<=0){this.notifications.warning("Informe um valor v\xE1lido.");return}this.submittingDeposit=!0;try{let r=await this.categoriesService.ensureCategory(t.uid,{name:"Investimentos",type:"expense",color:"#f97316"});await this.investmentsService.createDeposit(t.uid,{investmentId:e.id,accountId:this.depositForm.get("accountId")?.value||"",amount:s,date:this.depositForm.get("date")?.value||this.todayYmd,categoryId:r,notes:this.depositForm.get("notes")?.value||null}),this.notifications.success("Aporte registrado com sucesso."),this.closeDeposit()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.submittingDeposit=!1}}async confirmWithdraw(){if(this.withdrawForm.invalid){this.withdrawForm.markAllAsTouched(),this.notifications.warning("Preencha os campos obrigat\xF3rios.");return}let t=await T(this.auth.user$),e=this.selectedInvestment;if(!t||!e?.id)return;let s=Number(this.withdrawForm.get("amount")?.value??0);if(!Number.isFinite(s)||s<=0){this.notifications.warning("Informe um valor v\xE1lido.");return}let r=Number(e.totalEstimated??0);if(this.canValidateEstimated(e)&&r>0){let c=r*1.02;if(s>c){this.notifications.warning("Valor acima do estimado do investimento.");return}}else this.notifications.warning("Valor estimado. Verifique antes de confirmar.");this.submittingWithdraw=!0;try{let c=await this.resolveWithdrawCategory(t.uid);await this.investmentsService.createWithdraw(t.uid,{investmentId:e.id,accountId:this.withdrawForm.get("accountId")?.value||"",amount:s,date:this.withdrawForm.get("date")?.value||this.todayYmd,categoryId:c,notes:this.withdrawForm.get("notes")?.value||null}),this.notifications.success("Resgate registrado com sucesso."),this.closeWithdraw()}catch{this.notifications.error("N\xE3o foi poss\xEDvel concluir. Tente novamente.")}finally{this.submittingWithdraw=!1}}validateForm(){if(this.form.markAllAsTouched(),this.form.invalid)return"Preencha os campos obrigat\xF3rios.";let t=this.form.value;return!t.hadBeforeApp&&Number(t.principalBase??0)<=0?"Informe o valor aplicado inicial.":t.hadBeforeApp&&Number(t.currentValueAtOnboarding??0)<=0?"Informe o valor atual do investimento.":t.hadBeforeApp&&!t.systemStartDate?"Informe a data de alinhamento.":this.isManualMode&&Number(t.manualRate??0)<=0?"Informe a taxa manual.":this.yieldMode==="cdi_percent"&&Number(t.cdiPercent??0)<=0?"Informe o percentual do CDI.":null}buildPayload(){let t=this.form.value,e=!!t.hadBeforeApp,s=t.realStartDate||this.todayYmd,r=t.systemStartDate||s,c=Number(t.principalBase??0),x=0,h=this.toNumberOrNull(t.totalInvestedToDate),F=this.toNumberOrNull(t.currentValueAtOnboarding),B=this.toNumberOrNull(t.preAppYield);if(e){let Y=Number(F??0);h!==null&&h>0?(c=h,x=Math.max(0,Y-h)):B!==null&&B>=0?(x=B,c=Math.max(0,Y-x)):(c=Y,x=0)}else r=s,h=null,F=null,x=0;return{name:(t.name??"").trim(),type:t.type,status:t.status,realStartDate:s,systemStartDate:r,hadBeforeApp:e,principalBase:c,preAppYield:x,totalInvestedToDate:h,currentValueAtOnboarding:F,yieldMode:t.yieldMode,manualRate:this.toNumberOrNull(t.manualRate),cdiPercent:this.toNumberOrNull(t.cdiPercent),compounding:t.compounding??"monthly"}}buildView(t,e){let s=this.calculator.summarize(t,e),r=t.map(c=>{let x=this.calculator.calculate(c,e),h=x.updatedAt?U(x.updatedAt):"-";return R(M(M({},c),x),{typeLabel:this.typeLabel(c.type),statusLabel:c.status==="active"?"Ativo":"Inativo",updatedLabel:h})}).sort((c,x)=>c.status!==x.status?c.status==="active"?-1:1:c.name.localeCompare(x.name));return{summary:R(M({},s),{updatedLabel:s.updatedAt?U(s.updatedAt):"-"}),items:r}}typeLabel(t){return this.typeOptions.find(s=>s.value===t)?.label??"Manual"}canValidateEstimated(t){return!t.indexMissing&&!t.placeholderUsed}async resolveWithdrawCategory(t){let e=await T(this.categoriesService.list$(t)),s=h=>h.trim().toLowerCase(),r=e.filter(h=>h.type==="income"),c=r.find(h=>s(h.name)==="resgates");if(c?.id)return c.id;let x=r.find(h=>s(h.name)==="investimentos");return x?.id?x.id:this.categoriesService.ensureCategory(t,{name:"Resgates",type:"income",color:"#22c55e"})}hasYieldOverrides(){return!!(this.form.get("yieldMode")?.dirty||this.form.get("manualRate")?.dirty||this.form.get("cdiPercent")?.dirty||this.form.get("compounding")?.dirty)}toNumberOrNull(t){if(t==null||t==="")return null;let e=Number(t);return Number.isFinite(e)?e:null}emptyView(){return{summary:{totalInvested:0,totalEstimated:0,totalYield:0,totalYieldPercent:0,updatedAt:null,updatedLabel:"-",indexMissing:!1,count:0},items:[]}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=J({type:o,selectors:[["app-investments-page"]],decls:15,vars:7,consts:[["loadingTpl",""],["emptyInvestmentsTpl",""],[1,"row","g-3","investments-page"],[1,"col-12","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"text-uppercase","text-primary","small","mb-1"],[1,"fw-bold","mb-0"],[1,"d-flex","gap-2"],["class","btn btn-sm btn-outline-light","type","button",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","modal-backdrop",3,"click",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],[1,"col-12"],[1,"summary-grid"],[1,"glass-card","summary-card"],[1,"summary-label"],[1,"summary-value"],[1,"summary-sub"],[1,"summary-tag"],["class","col-12",4,"ngIf"],[1,"col-lg-4"],[1,"glass-card","p-3","h-100"],[1,"fw-semibold","mb-3"],[1,"d-grid","gap-3",3,"ngSubmit","formGroup"],[1,"form-label","text-secondary"],["formControlName","name","placeholder","Ex: Reserva",1,"form-control","glass-input"],["formControlName","type",1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"text-secondary"],[1,"row","g-2"],[1,"col-6"],["type","date","formControlName","realStartDate",1,"form-control","glass-input"],["formControlName","status",1,"form-select"],[1,"form-check","form-switch"],["type","checkbox","id","investment-before-app","formControlName","hadBeforeApp",1,"form-check-input",3,"change"],["for","investment-before-app",1,"form-check-label"],[4,"ngIf"],["class","d-grid gap-2",4,"ngIf"],["formControlName","yieldMode",1,"form-select",3,"change"],["class","row g-2",4,"ngIf"],["formControlName","compounding",1,"form-select"],["value","monthly"],["value","daily"],["type","submit",1,"btn","btn-primary","flex-grow-1",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["type","button",1,"btn","btn-outline-light",3,"click"],[1,"col-lg-8"],[1,"table-responsive"],[1,"table","table-hover","align-middle","table-sm","app-table","investments-table"],[1,"text-end"],[1,"glass-card","p-3","text-warning"],[3,"value"],["type","number","formControlName","principalBase","step","0.01","placeholder","Ex: 5000.00",1,"form-control","glass-input"],[1,"d-grid","gap-2"],["type","date","formControlName","systemStartDate",1,"form-control","glass-input"],["type","number","formControlName","currentValueAtOnboarding","step","0.01","placeholder","Ex: 12000.00",1,"form-control","glass-input"],["type","number","formControlName","totalInvestedToDate","step","0.01","placeholder","Opcional",1,"form-control","glass-input"],["type","number","formControlName","preAppYield","step","0.01","placeholder","Opcional",1,"form-control","glass-input"],["type","number","formControlName","manualRate","step","0.01","placeholder","Ex: 1.2",1,"form-control","glass-input"],["class","col-6",4,"ngIf"],["type","number","formControlName","manualRate","step","0.01","placeholder","Opcional",1,"form-control","glass-input"],["type","number","formControlName","cdiPercent","step","0.01","placeholder","Ex: 100",1,"form-control","glass-input"],[1,"spinner-border","spinner-border-sm","me-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"fw-semibold"],[1,"text-secondary","small"],["class","text-secondary small",4,"ngIf"],["class","text-warning small",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"text-end","actions-cell"],[1,"actions-stack"],[1,"actions-row","actions-primary"],["type","button","title","Adicionar valor ao investimento",1,"btn","btn-sm","btn-outline-success","action-btn",3,"click","disabled"],[1,"bi","bi-plus-circle"],[1,"action-label"],["type","button","title","Resgatar valor do investimento",1,"btn","btn-sm","btn-outline-warning","action-btn",3,"click","disabled"],[1,"bi","bi-dash-circle"],[1,"actions-row","actions-secondary"],["type","button","title","Editar investimento",1,"btn","btn-sm","btn-outline-light","action-btn","action-btn--ghost",3,"click"],[1,"bi","bi-pencil"],[1,"action-label","action-label--secondary"],["type","button",1,"btn","btn-sm","btn-outline-danger","action-btn","action-btn--danger",3,"click","disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],[1,"bi","bi-power"],[1,"text-warning","small"],[1,"spinner-border","spinner-border-sm","me-1"],["colspan","6"],[1,"empty-state"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"glass-card","p-3"],[1,"skeleton","skeleton-line","w-50","mb-2"],[1,"skeleton","skeleton-line","w-75"],["class","col-12",4,"ngFor","ngForOf"],[1,"modal-backdrop",3,"click"],[1,"glass-card","modal-card",3,"click"],[1,"modal-header-row"],[1,"fw-semibold","mb-0"],[1,"d-grid","gap-3","mt-3",3,"ngSubmit","formGroup"],["type","number","formControlName","amount","step","0.01",1,"form-control","glass-input"],["type","date","formControlName","date",1,"form-control","glass-input"],["formControlName","accountId",1,"form-select"],["value","","disabled",""],["formControlName","notes","placeholder","Opcional",1,"form-control","glass-input"],[1,"text-secondary","small","mt-2"]],template:function(e,s){if(e&1&&(i(0,"div",2)(1,"div",3)(2,"div")(3,"p",4),a(4,"Patrimonio"),n(),i(5,"h3",5),a(6,"Investimentos"),n()(),i(7,"div",6),u(8,Pe,2,0,"button",7),n()(),u(9,Ge,112,51,"ng-container",8),y(10,"async"),u(11,He,5,1,"ng-template",null,0,G)(13,Qe,35,7,"div",9)(14,tt,39,17,"div",9),n()),e&2){let r=q(12);l(8),m("ngIf",s.editingId),l(),m("ngIf",k(10,5,s.view$))("ngIfElse",r),l(4),m("ngIf",s.showDepositModal),l(),m("ngIf",s.showWithdrawModal)}},dependencies:[ae,X,Z,ee,be,pe,fe,xe,me,ue,se,_e,de,ce,ge,ve,te,ne,ie],styles:[".summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.summary-card[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:6px;min-height:120px}.summary-label[_ngcontent-%COMP%]{font-size:.7rem;letter-spacing:.14em;text-transform:uppercase;color:var(--app-muted)}.summary-value[_ngcontent-%COMP%]{font-size:1.45rem;font-weight:600}.summary-sub[_ngcontent-%COMP%]{font-size:.85rem;color:var(--app-muted)}.summary-tag[_ngcontent-%COMP%]{margin-top:auto;padding:4px 10px;border-radius:999px;font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;background:#6366f133;border:1px solid rgba(99,102,241,.35);color:#c7d2fe;width:fit-content}.investments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:top}.investments-table[_ngcontent-%COMP%]   td.actions-cell[_ngcontent-%COMP%]{vertical-align:middle}.actions-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px}.actions-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:nowrap}.actions-secondary[_ngcontent-%COMP%]{gap:6px}.action-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:12px}.action-btn--ghost[_ngcontent-%COMP%]{opacity:.9}.action-btn--danger[_ngcontent-%COMP%]{border-color:#f8717180;color:#fca5a5}.action-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600}.action-label--secondary[_ngcontent-%COMP%]{font-weight:500}@media(max-width:992px){.action-label--secondary[_ngcontent-%COMP%]{display:none}.action-btn[_ngcontent-%COMP%]{padding:6px 8px}}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#070a14a6;display:flex;align-items:center;justify-content:center;padding:16px;z-index:1050}.modal-card[_ngcontent-%COMP%]{width:min(520px,100%);padding:20px;border-radius:18px}.modal-header-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}"]})};var Et=[{path:"",component:D}];export{Et as INVESTMENTS_ROUTES};
