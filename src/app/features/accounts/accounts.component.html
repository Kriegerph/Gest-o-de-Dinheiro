<div class="row g-3">
  <div class="col-12 d-flex align-items-center justify-content-between">
    <div>
      <p class="text-uppercase text-primary small mb-1">Organização</p>
      <h3 class="fw-bold mb-0">Contas</h3>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="glass-card p-3 h-100">
      <h6 class="fw-semibold mb-3">{{ editingId ? 'Editar conta' : 'Nova conta' }}</h6>
      <form [formGroup]="form" class="d-grid gap-3" (ngSubmit)="save()">
        <div>
          <label class="form-label text-secondary">Nome</label>
          <input class="form-control glass-input" formControlName="name" placeholder="Ex: Banco principal" />
        </div>
        <div>
          <label class="form-label text-secondary">Saldo inicial</label>
          <input type="number" class="form-control glass-input" formControlName="initialBalance"
            placeholder="Ex: 500.00" step="0.01" />
        </div>
        <div>
          <label class="form-label text-secondary">Cor</label>
          <input class="form-control form-control-color w-100" type="color" formControlName="color" />
        </div>

        <div class="d-flex gap-2">
          <button class="btn btn-primary flex-grow-1" type="submit" [disabled]="saving">
            <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
            {{ saving ? 'Salvando...' : editingId ? 'Salvar alteracoes' : 'Adicionar' }}
          </button>
          <button class="btn btn-outline-light" type="button" (click)="resetForm()">Limpar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="col-lg-8">
    <div class="glass-card p-3 h-100">
      <div class="table-responsive">
        <table class="table table-hover align-middle table-sm app-table">
          <thead>
            <tr class="text-secondary">
              <th>Nome</th>
              <th class="text-end">Saldo atual</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="view$ | async as accounts; else loadingAccountsTpl">
              <ng-container *ngIf="accounts.length > 0; else emptyAccountsTpl">
                <tr *ngFor="let account of accounts; trackBy: trackById">
                  <td>
                    <span class="badge rounded-pill me-2" [style.background]="account.color || '#94a3b8'">
                      &nbsp;
                    </span>
                    {{ account.name }}
                  </td>
                  <td class="text-end fw-semibold">
                    {{ account.currentBalance | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
                  </td>
                  <td class="text-end">
                    <button class="btn btn-sm btn-outline-light me-2" (click)="edit(account)">
                      <i class="bi bi-pencil me-1"></i>
                      Editar
                    </button>
                    <button class="btn btn-sm btn-outline-light" (click)="delete(account)"
                      [disabled]="deletingId === account.id">
                      <span *ngIf="deletingId === account.id" class="spinner-border spinner-border-sm me-1"></span>
                      {{ deletingId === account.id ? 'Excluindo...' : 'Excluir' }}
                    </button>
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </tbody>
          <ng-template #loadingAccountsTpl>
            <tr *ngFor="let _ of skeletonRows">
              <td>
                <div class="skeleton skeleton-line w-75"></div>
              </td>
              <td class="text-end">
                <div class="skeleton skeleton-line w-50 ms-auto"></div>
              </td>
              <td class="text-end">
                <div class="skeleton skeleton-line w-50 ms-auto"></div>
              </td>
            </tr>
          </ng-template>
          <ng-template #emptyAccountsTpl>
            <tr>
              <td colspan="3">
                <div class="empty-state">
                  <div>Nenhum dado encontrado para este período</div>
                  <button class="btn btn-sm btn-primary" type="button" (click)="resetForm()">
                    Cadastrar conta
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>
        </table>
      </div>
    </div>
  </div>
</div>